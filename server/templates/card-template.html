<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script type="application/ld+json">
        {
          "@context": "https://schema.org",
          "@type": "Organization",
          "name": "QRMyPro",
          "url": "https://qrmypro.com",
          "logo": "https://qrmypro.com/image/app-logo.png",
          "description": "QRMyPro is a free, all-in-one digital profile and QR code platform that lets you create, manage, and share your personal or business profile with one click ‚Äî through a digital card or QR code link.",
          "founder": {
            "@type": "Person",
            "name": "Harshil Patel",
            "jobTitle": "Technical Architect & Engineering Manager",
            "worksFor": {
              "@type": "Organization",
              "name": "QRMyPro"
            }
          },
          "contactPoint": {
            "@type": "ContactPoint",
            "contactType": "customer support",
            "email": "support@qrmypro.com"
          },
          "potentialAction": {
            "@type": "CreateAction",
            "target": {
              "@type": "EntryPoint",
              "urlTemplate": "https://qrmypro.com/signup"
            },
            "result": {
              "@type": "DigitalDocument",
              "name": "QRMyPro Digital Profile"
            }
          }
        }
        </script>
    <script type="application/ld+json">
            {
              "@context": "https://schema.org",
              "@type": "FAQPage",
              "mainEntity": [{
                "@type": "Question",
                "name": "How do I create a QR code?",
                "acceptedAnswer": {
                  "@type": "Answer",
                  "text": "You can create a QR code using our free generator at qrmypro.com."
                }
              }, {
                "@type": "Question",
                "name": "Is it free to use QRMyPro?",
                "acceptedAnswer": {
                  "@type": "Answer",
                  "text": "Yes, basic QR code generation is completely free."
                }
              }]
            }
            </script>
    <script type="application/ld+json">
                {
                  "@context": "https://schema.org",
                  "@type": "WebApplication",
                  "name": "QRMyPro",
                  "url": "https://www.qrmypro.com",
                  "applicationCategory": "UtilityApplication",
                  "operatingSystem": "Web",
                  "description": "QRMyPro is a free digital profile creator that lets you connect and share all your online links, social media, and contact info using a single QR code or digital card.",
                  "image": "https://www.qrmypro.com/assets/og-image.jpg",
                  "author": {
                    "@type": "Organization",
                    "name": "QRMyPro"
                  },
                  "publisher": {
                    "@type": "Organization",
                    "name": "QRMyPro",
                    "url": "https://www.qrmypro.com",
                    "logo": {
                      "@type": "ImageObject",
                      "url": "https://www.qrmypro.com/assets/logo.png"
                    }
                  },
                  "featureList": [
                    "Create digital profiles with all your social and web links",
                    "Generate shareable QR codes for personal or business use",
                    "Free to use ‚Äî no premium plan required",
                    "Instant sharing via link or QR card",
                    "Manage your professional digital identity under one platform"
                  ],
                  "inLanguage": "en",
                  "offers": {
                    "@type": "Offer",
                    "price": "0",
                    "priceCurrency": "USD",
                    "category": "FreeSoftware",
                    "availability": "https://schema.org/InStock"
                  },
                  "aggregateRating": {
                    "@type": "AggregateRating",
                    "ratingValue": "4.9",
                    "ratingCount": "120"
                  }
                }
                </script>

    <!-- Favicon icon -->
    <link rel="icon" type="image/png" href="/favicon/favicon-96x96.png" sizes="96x96" />
    <link rel="icon" type="image/svg+xml" href="/favicon/favicon.svg" />
    <link rel="shortcut icon" href="/favicon/favicon.ico" />
    <link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-touch-icon.png" />
    <link rel="manifest" href="/favicon/site.webmanifest" />

    <!-- Dynamically add canonical tag -->
    <script>
        // Create canonical link element
        const canonical = document.createElement('link');
        canonical.rel = 'canonical';
        canonical.href = 'https://www.qrmypro.com' + window.location.pathname;

        // Add to head
        document.head.appendChild(canonical);
    </script>
    <script src="/js/jquery-3.2.1.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <title>{{name}} - Digital Business Card</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            flex-direction: column;
        }

        .newuser-section {
            max-width: 500px;
            width: 100%;
            display: flex;
            color: #7254b1;
            border: 1px solid white;
            padding: 10px 4px;
            border-radius: 7px;
            margin-bottom: 4px;
            justify-content: center;
            background: white;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
        }

        .card-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 24px;
            padding: 40px;
            max-width: 500px;
            width: 100%;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.2);
            position: relative;
            overflow: hidden;
        }

        .card-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #667eea, #764ba2, #f093fb, #f5576c);
        }

        .profile-section {
            background: #f8f9fa;
            /* padding: 20px; */
            border-radius: 12px;
            text-align: center;
            /* margin-bottom: 32px; */
        }

        .profile-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }

        /* App Logo (Top Left) */
        .app-logo {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .logo-image {
            height: 32px;
            width: auto;
            border-radius: 6px;
            cursor: pointer;
        }

        .logo-text {
            font-size: 1.2rem;
            font-weight: bold;
            color: #2c3e50;
        }
        #cardAvatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 50%;
        }

        /* Main Profile Content (Center) */
        .profile-content {
            text-align: center;
        }

        .profile-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea, #764ba2);
            display: flex;
            align-items: center;
            justify-content: center;
            /* margin: 0 auto 20px; */
            color: white;
            font-size: 20px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 2px;
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
        }

        .profile-name {
            font-size: 1.6rem;
            font-weight: 600;
            color: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            margin-bottom: 8px;
            line-height: 1.2;
            /* background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); */
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            color: transparent;
        }

        .profile-title {
            font-size: 1.1rem;
            color: #667eea;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .profile-organization {
            font-size: 1rem;
            color: #718096;
            font-weight: 500;
        }

        .contact-section {
            margin: 32px 0;
        }

        .contact-item {
            display: flex;
            align-items: center;
            padding: 6px;
            margin-bottom: 12px;
            background: rgba(102, 126, 234, 0.08);
            border-radius: 8px;
            transition: all 0.3s ease;
            cursor: pointer;
            text-decoration: none;
            color: inherit;
            border: 1px solid rgb(127 102 234);
        }

        .contact-item:hover {
            background: rgba(102, 126, 234, 0.15);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.2);
        }

        .contact-icon {
            width: 26px;
            height: 26px;
            border-radius: 12px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 14px;
            margin-right: 16px;
            flex-shrink: 0;
        }

        .contact-info {
            flex-grow: 1;
        }

        .contact-label {
            font-size: 0.75rem;
            color: #718096;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 2px;
        }

        .contact-value {
            font-size: 0.8rem;
            color: #2d3748;
            font-weight: 600;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            color: transparent;
        }

        .social-section {
            margin: 32px 0;
        }


        .section-title {
            font-size: 1rem;
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 20px;
            text-align: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            color: transparent;
        }

        .social-links {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
            gap: 16px;
        }

        .social-link {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 8px 4px;
            background: rgba(102, 126, 234, 0.08);
            border-radius: 16px;
            text-decoration: none;
            color: #667eea;
            transition: all 0.3s ease;
            border: 1px solid rgb(127 102 234);
        }

        .social-link:hover {
            background: rgba(102, 126, 234, 0.15);
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.2);
        }

        .social-label {
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: capitalize;
        }

        .notes-section,
        .address-section {
            margin: 32px 0;
            padding: 24px;
            background: rgba(245, 87, 108, 0.08);
            border-radius: 16px;
            border-left: 4px solid #f5576c;
        }

        .address-section {
            background: rgba(118, 75, 162, 0.08);
            border-left-color: #764ba2;
        }

        .actions-section {
            display: flex;
            justify-content: center;
            margin-top: 10px;
            gap: 1rem;
        }

        .action-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 8px 24px;
            border-radius: 12px;
            text-decoration: none;
            font-weight: 400;
            transition: all 0.3s ease;
            border: none;
            cursor: pointer;
            font-size: 0.8rem;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            gap: 0.5rem;
        }

        @media (max-width: 550px) {
            .actions-section {
                flex-direction: column;
            }
        }

        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
        }

        .views-counter {
            display: inline-flex;
            align-items: center;
            background: rgba(102, 126, 234, 0.1);
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            color: #667eea;
            margin-top: 12px;
        }

        .hidden {
            display: none;
        }

        @media (max-width: 480px) {
            .card-container {
                padding: 24px;
                margin: 10px;
            }

            .profile-name {
                font-size: 1.2rem;
            }

            .profile-avatar {
                width: 40px;
                height: 40px;
                font-size: 14px;
            }

            .social-links {
                grid-template-columns: repeat(auto-fit, minmax(70px, 1fr));
            }
        }

        .card-container {
            animation: slideIn 0.6s ease-out;
        }

        a.contact-item.contact-phone {
            width: 100%;
            /* gap: 0.5rem; */
        }

        .contact-div {
            display: flex;
            flex-direction: row;
            justify-content: space-around;
            gap: 0.5rem;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(30px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>
    <style>
        /* Map Selection Modal */
        .map-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .map-modal.active {
            opacity: 1;
        }

        .map-modal-content {
            background: white;
            border-radius: 16px;
            padding: 2rem;
            max-width: 400px;
            width: 90%;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            transform: scale(0.9);
            transition: transform 0.3s ease;
        }

        .map-modal.active .map-modal-content {
            transform: scale(1);
        }

        .map-modal-content h3 {
            margin: 0 0 0.5rem 0;
            font-size: 1.3rem;
            color: #333;
            text-align: center;
        }

        .location-text {
            text-align: center;
            color: #666;
            font-size: 0.9rem;
            margin-bottom: 1.5rem;
        }

        .map-options {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .map-option-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.75rem;
            padding: 1rem;
            border-radius: 10px;
            text-decoration: none;
            font-weight: 500;
            font-size: 1rem;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .map-option-btn i {
            font-size: 1.3rem;
        }

        .map-option-btn.apple-maps {
            background: linear-gradient(135deg, #007AFF, #0051D5);
            color: white;
        }

        .map-option-btn.apple-maps:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 122, 255, 0.3);
        }

        .map-option-btn.google-maps {
            background: linear-gradient(135deg, #4285F4, #34A853);
            color: white;
        }

        .map-option-btn.google-maps:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(66, 133, 244, 0.3);
        }

        .close-modal-btn {
            width: 100%;
            padding: 0.875rem;
            background: #f0f0f0;
            color: #666;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        .close-modal-btn:hover {
            background: #e0e0e0;
        }

        .location-item {
            cursor: pointer;
        }

        /* Responsive */
        @media (max-width: 480px) {
            .map-modal-content {
                padding: 1.5rem;
            }

            .map-modal-content h3 {
                font-size: 1.1rem;
            }

            .map-option-btn {
                padding: 0.875rem;
                font-size: 0.95rem;
            }
        }
    </style>
</head>

<body>
    <div class="newuser-section">
        <div class="join-tagline">Create QRProfile for me</div>
    </div>
    <div class="card-container">

        <!-- Profile Section -->
        <div class="profile-section">

            <div class="profile-header">
                <div class="app-logo">
                    <img id="profile-page-logo" src="/image/app-logo.png" alt="QRprofile Logo" class="logo-image">
                    <!-- <span class="logo-text">QRprofile</span> -->
                </div>
                <!-- <div class="profile-avatar">{{initials}}</div> -->
                <!-- Profile Avatar/Photo -->
                <div class="profile-avatar" id="cardAvatar">
                    <!-- {{#if hasProfilePhoto}}
                    <img src="/api/profile/photo/{{profileId}}" alt="{{name}}">
                    {{else}}
                    <span>{{initials}}</span>
                    {{/if}} -->
                </div>
            </div>
            <div class="profile-content">
                <!-- <div class="profile-avatar">{{initials}}</div> -->
                <h1 class="profile-name">{{name}}</h1>
                <div class="profile-title">{{title}}</div>
                <div class="profile-organization">{{organization}}</div>
                <div class="views-counter">
                    üìä {{views}} views
                </div>
            </div>
        </div>

        <!-- Action Buttons -->
        <div class="actions-section">
            <a href="/api/card/{{cardId}}/vcard" class="action-btn">
                <i class="fas fa-save"></i> <span>Save Contact</span>
            </a>
            <a href="javascript:window.open(window.location.origin, '_blank')" class="action-btn">
                <i class="fas fa-qrcode"></i> <span>Create my QRProfile</span>
            </a>
        </div>

        <!-- Social Media Links -->
        <div class="social-section" id="socialSection" style="display: none;">
            <h3 class="section-title">Connect With Me</h3>
            <div class="social-links" id="socialLinks">
                <!-- Social links will be populated by JavaScript -->
            </div>
        </div>

        <!-- Contact Information -->
        <div class="contact-section" id="contactSection">
            <!-- Contact items will be populated by JavaScript -->
        </div>

        <!-- Address -->
        <div class="address-section" id="addressSection" style="display: none;">
            <h3 class="section-title">üìç Location</h3>
            <div class="address-text">{{address}}</div>
        </div>

        <!-- Action Buttons -->
        <div class="actions-section">
            <a href="/api/card/{{cardId}}/vcard" class="action-btn">
                üíæ Save Contact
            </a>
        </div>

        <!-- Notes -->
        <div class="notes-section" id="notesSection" style="display: none;">
            <h3 class="section-title">üìù About</h3>
            <div class="notes-text">{{notes}}</div>
        </div>

        <div id="resolution-message"
            style="position: fixed; top: 0px; left: 0px; width: 100%; height: 100%; background: linear-gradient(135deg, rgb(102, 126, 234) 0%, rgb(118, 75, 162) 100%); display: flex; align-items: center; justify-content: center; z-index: 9999; font-family: -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, sans-serif;">
            <div
                style="background: white; padding: 2rem; border-radius: 20px; text-align: center; max-width: 90%; box-shadow: rgba(0, 0, 0, 0.3) 0px 20px 40px;">
                <div style="font-size: 3rem; margin-bottom: 1rem;">üì±</div>
                <h2 style="color: #333; margin-bottom: 1rem; font-size: 1.5rem;">Screen Too Small</h2>
                <p style="color: #666; margin-bottom: 1.5rem; line-height: 1.5;">
                    This application requires a minimum screen width of 400px for the best experience.
                    Please rotate your device or use a larger screen.
                </p>
                <p style="color: #999; font-size: 0.9rem;">
                    Current width: 341px | Required: 400px minimum
                </p>
            </div>
        </div>
    </div>


    <script>

        function normalizeUrl(url) {
            if (!url || url.trim() === '') return '';

            url = url.trim();

            // If URL already has protocol, return as is
            if (/^https?:\/\//i.test(url)) {
                return url;
            }

            // Add https:// if missing
            return 'https://' + url;
        }
        function showMapOptions(encodedLocation, locationString) {
            const googleMapsUrl = `https://www.google.com/maps/search/?api=1&query=${encodedLocation}`;
            const appleMapsUrl = `https://maps.apple.com/?q=${encodedLocation}`;

            // Create modal for map selection
            const modalHTML = `
        <div id="mapModal" class="map-modal">
            <div class="map-modal-content">
                <h3>Open Location in:</h3>
                <p class="location-text">${locationString}</p>
                <div class="map-options">
                    <a href="${appleMapsUrl}" class="map-option-btn apple-maps" onclick="trackContact('apple_maps')">
                        <i class="fas fa-map"></i>
                        <span>Apple Maps</span>
                    </a>
                    <a href="${googleMapsUrl}" target="_blank" class="map-option-btn google-maps" onclick="trackContact('google_maps')">
                        <i class="fab fa-google"></i>
                        <span>Google Maps</span>
                    </a>
                </div>
                <button class="close-modal-btn" onclick="closeMapModal()">Cancel</button>
            </div>
        </div>
    `;

            // Remove existing modal if present
            const existingModal = document.getElementById('mapModal');
            if (existingModal) {
                existingModal.remove();
            }

            // Add modal to body
            document.body.insertAdjacentHTML('beforeend', modalHTML);

            // Show modal with animation
            setTimeout(() => {
                document.getElementById('mapModal').classList.add('active');
            }, 10);
        }

        function closeMapModal() {
            const modal = document.getElementById('mapModal');
            if (modal) {
                modal.classList.remove('active');
                setTimeout(() => modal.remove(), 300);
            }
        }

        // Close modal when clicking outside
        document.addEventListener('click', (e) => {
            const modal = document.getElementById('mapModal');
            if (modal && e.target === modal) {
                closeMapModal();
            }
        });

        function hideResolutionMessage() {
            const existingMessage = document.getElementById('resolution-message');
            if (existingMessage) {
                existingMessage.remove();
            }
        }

        function showResolutionMessage() {
            // Remove existing message if any
            const existingMessage = document.getElementById('resolution-message');
            if (existingMessage) {
                existingMessage.remove();
            }

            // Create message overlay
            const messageOverlay = document.createElement('div');
            messageOverlay.id = 'resolution-message';
            messageOverlay.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 9999;
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            `;

            // Create message content
            const messageContent = document.createElement('div');
            messageContent.style.cssText = `
                background: white;
                padding: 2rem;
                border-radius: 20px;
                text-align: center;
                max-width: 90%;
                box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            `;

            messageContent.innerHTML = `
                <div style="font-size: 3rem; margin-bottom: 1rem;">üì±</div>
                <h2 style="color: #333; margin-bottom: 1rem; font-size: 1.5rem;">Screen Too Small</h2>
                <p style="color: #666; margin-bottom: 1.5rem; line-height: 1.5;">
                    This application requires a minimum screen width of 400px for the best experience. 
                    Please rotate your device or use a larger screen.
                </p>
                <p style="color: #999; font-size: 0.9rem;">
                    Current width: ${window.innerWidth}px | Required: 400px minimum
                </p>
            `;

            messageOverlay.appendChild(messageContent);
            document.body.appendChild(messageOverlay);
        }
        // Function to check screen width and hide/show elements
        function checkScreenWidth() {
            const profilesection = document.querySelector('.card-container');

            const screenWidth = window.innerWidth;

            if (screenWidth < 300) {
                profilesection.style.display = 'none';

                showResolutionMessage();
            } else {
                profilesection.style.display = 'flex';
                profilesection.style.display = 'block';
                hideResolutionMessage();
            }
        }

        // Check on page load
        document.addEventListener('DOMContentLoaded', checkScreenWidth);

        // Check on window resize
        window.addEventListener('resize', checkScreenWidth);




        $('.newuser-section').click(function () {
            window.open(window.location.origin, '_blank');
        });

        $('.logo-image').click(function () {
            window.open(window.location.origin, '_blank');
        });
        // Contact data from server - now properly injected as JSON
        // const contactData = {{ contactDataJSON }};
        const contactDataString = '{{contactDataJSON}}';
        const contactData = JSON.parse(contactDataString);
        // ADD this right after the contactData declaration in your HTML template (REMOVE after testing)
        // console.log('Frontend contactData:', contactData);
        // console.log('Frontend socialMedia:', contactData.socialMedia);
        // Populate contact section
        function populateContacts() {
            const contactSection = document.getElementById('contactSection');
            let contactHtml = '';
            let phonedivhtml = '';
            let contentdivhtml = ''
            if (contactData.phone && contactData.phone.trim()) {
                phonedivhtml += `
            <a href="tel:${contactData.phone}" class="contact-item contact-phone" onclick="trackContact('phone')">
                <div class="contact-icon"><i class="fas fa-phone"></i></div>
                <div class="contact-info">
                    <div class="contact-label">Phone</div>
                    <div class="contact-value">${contactData.phone}</div>
                </div>
            </a>
        `;
            }

            if (contactData.mobile && contactData.mobile.trim()) {
                phonedivhtml += `
            <a href="tel:${contactData.mobile}" class="contact-item contact-phone" onclick="trackContact('mobile')">
                <div class="contact-icon"><i class="fas fa-mobile-alt"></i></div>
                <div class="contact-info">
                    <div class="contact-label">Mobile</div>
                    <div class="contact-value">${contactData.mobile}</div>
                </div>
            </a>
        `;
            }

            if (contactData.email && contactData.email.trim()) {
                contentdivhtml += `
            <a href="mailto:${contactData.email}" class="contact-item" onclick="trackContact('email')">
                <div class="contact-icon"><i class="fas fa-envelope"></i></div>
                <div class="contact-info">
                    <div class="contact-label">Email</div>
                    <div class="contact-value">${contactData.email}</div>
                </div>
            </a>
        `;
            }

            if (contactData.website && contactData.website.trim()) {
                const normalizedWebsite = normalizeUrl(contactData.website);

                contentdivhtml += `
        <a href="${normalizedWebsite}" target="_blank" class="contact-item" onclick="trackContact('website')">
            <div class="contact-icon"><i class="fas fa-globe"></i></div>
            <div class="contact-info">
                <div class="contact-label">Website</div>
                <div class="contact-value">${contactData.website}</div>
            </div>
        </a>
    `;
            }

            // Display location only if country exists and has data
            // Display location only if country exists and has data
            if (contactData.country && contactData.country.name && contactData.country.name.trim()) {
                // Build location string
                let locationParts = [];

                if (contactData.city && contactData.city.name && contactData.city.name.trim()) {
                    locationParts.push(contactData.city.name);
                }

                if (contactData.state && contactData.state.name && contactData.state.name.trim()) {
                    locationParts.push(contactData.state.name);
                }

                locationParts.push(contactData.country.name);

                const locationString = locationParts.join(', ');
                const encodedLocation = encodeURIComponent(locationString);

                // Detect device type
                const userAgent = navigator.userAgent || navigator.vendor || window.opera;
                const isIOS = /iPad|iPhone|iPod/.test(userAgent) && !window.MSStream;
                const isAndroid = /android/i.test(userAgent);

                if (isIOS) {
                    // For iOS - show both options
                    contentdivhtml += `
            <div class="contact-item location-item" onclick="showMapOptions('${encodedLocation}', '${locationString.replace(/'/g, "\\'")}')">
                <div class="contact-icon"><i class="fas fa-map-marker-alt"></i></div>
                <div class="contact-info">
                    <div class="contact-label">Location</div>
                    <div class="contact-value">${locationString}</div>
                </div>
            </div>
        `;
                } else {
                    // For Android and other devices - direct Google Maps link
                    const googleMapsUrl = `https://www.google.com/maps/search/?api=1&query=${encodedLocation}`;

                    contentdivhtml += `
            <a href="${googleMapsUrl}" target="_blank" class="contact-item" onclick="trackContact('location')">
                <div class="contact-icon"><i class="fas fa-map-marker-alt"></i></div>
                <div class="contact-info">
                    <div class="contact-label">Location</div>
                    <div class="contact-value">${locationString}</div>
                </div>
            </a>
        `;
                }
            }

            phonedivhtml = `<div class='contact-div'>${phonedivhtml}</div>`;
            contentdivhtml = `<div class='othercontact-div'>${contentdivhtml}</div>`;
            contactSection.innerHTML = phonedivhtml + contentdivhtml;
        }

        // 
        // UPDATE the populateSocialMedia function (around line 400 in your template)
        function populateSocialMedia() {
            const socialSection = document.getElementById('socialSection');
            const socialLinks = document.getElementById('socialLinks');

            // EXPANDED social platforms list with Font Awesome icons
            const socialPlatforms = {
                instagram: { icon: 'fab fa-instagram', name: 'Instagram' },
                facebook: { icon: 'fab fa-facebook', name: 'Facebook' },
                twitter: { icon: 'fab fa-twitter', name: 'Twitter' },
                linkedin: { icon: 'fab fa-linkedin', name: 'LinkedIn' },
                github: { icon: 'fab fa-github', name: 'GitHub' },
                youtube: { icon: 'fab fa-youtube', name: 'YouTube' },
                tiktok: { icon: 'fab fa-tiktok', name: 'TikTok' },
                snapchat: { icon: 'fab fa-snapchat', name: 'Snapchat' },
                whatsapp: { icon: 'fab fa-whatsapp', name: 'WhatsApp' },
                calendly: { icon: 'fas fa-calendar-alt', name: 'Calendly' },
                zoom: { icon: 'fas fa-headphones', name: 'Zoom' },
                discord: { icon: 'fab fa-discord', name: 'Discord' },
                telegram: { icon: 'fa-brands fa-telegram', name: 'Telegram' },
                pinterest: { icon: 'fa-brands fa-pinterest', name: 'Pinterest' },
                reddit: { icon: 'fa-brands fa-reddit', name: 'Reddit' }
            };

            let socialHtml = '';
            let hasAnySocial = false;

            // Check if socialMedia exists and has properties
            if (contactData.socialMedia && typeof contactData.socialMedia === 'object') {
                Object.entries(contactData.socialMedia).forEach(([platform, url]) => {
                    if (url && url.trim() && url !== '') {
                        hasAnySocial = true;
                        const platformData = socialPlatforms[platform];
                        const icon = platformData ? platformData.icon : 'fas fa-link';
                        const name = platformData ? platformData.name : platform.charAt(0).toUpperCase() + platform.slice(1);

                        socialHtml += `
                    <a href="${url}" target="_blank" class="social-link" onclick="trackSocial('${platform}')">
                        <i class="${icon}" style="font-size: 24px; margin-bottom: 8px;"></i>
                        <span style="font-size: 0.8rem; font-weight: 600;">${name}</span>
                    </a>
                `;
                    }
                });
            }

            if (hasAnySocial) {
                socialLinks.innerHTML = socialHtml;
                socialSection.style.display = 'block';
            } else {
                socialSection.style.display = 'none';
            }
        }

        function renderCardPhoto(cardData) {
            // console.log("contactData.cardId: ", contactData.cardId);
            const photoHtml = contactData.hasProfilePhoto
                ? `<img src="/api/profile/photo/card/${contactData.cardId}" alt="${contactData.initials}">`
                : `<span>${contactData.initials}</span>`;

            $('.profile-avatar').html(photoHtml);
        }
        // Show/hide sections based on content
        function toggleSections() {
            // Address section
            if (contactData.address && contactData.address.trim()) {
                // document.getElementById('addressSection').style.display = 'block';

            }

            // Notes section
            if (contactData.notes && contactData.notes.trim()) {
                document.getElementById('notesSection').style.display = 'block';
            }
        }

        // Track contact interactions
        function trackContact(action) {
            fetch(`/api/card/${contactData.cardId}/track/contact/${action}`, {
                method: 'POST'
            }).catch(() => { });
        }

        // Track social media clicks
        function trackSocial(platform) {
            fetch(`/api/card/${contactData.cardId}/track/${platform}`, {
                method: 'POST'
            }).catch(() => { });
        }

        // Initialize the page
        document.addEventListener('DOMContentLoaded', function () {
            populateContacts();
            populateSocialMedia();
            toggleSections();
            renderCardPhoto()

        });
    </script>
</body>

</html>