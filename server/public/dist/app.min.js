var __defProp=Object.defineProperty,__getOwnPropSymbols=Object.getOwnPropertySymbols,__hasOwnProp=Object.prototype.hasOwnProperty,__propIsEnum=Object.prototype.propertyIsEnumerable,__defNormalProp=(e,t,n)=>t in e?__defProp(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,__spreadValues=(e,t)=>{for(var n in t||(t={}))__hasOwnProp.call(t,n)&&__defNormalProp(e,n,t[n]);if(__getOwnPropSymbols)for(var n of __getOwnPropSymbols(t))__propIsEnum.call(t,n)&&__defNormalProp(e,n,t[n]);return e},__async=(e,t,n)=>new Promise((o,i)=>{var a=e=>{try{l(n.next(e))}catch(t){i(t)}},s=e=>{try{l(n.throw(e))}catch(t){i(t)}},l=e=>e.done?o(e.value):Promise.resolve(e.value).then(a,s);l((n=n.apply(e,t)).next())});!function(){"use strict";const e=function(e,t,n){let o=Promise.resolve();function i(e){const t=new Event("vite:preloadError",{cancelable:!0});if(t.payload=e,window.dispatchEvent(t),!t.defaultPrevented)throw e}return o.then(t=>{for(const e of t||[])"rejected"===e.status&&i(e.reason);return e().catch(i)})},t=window.location.origin,n=5242880,o=60,i=60,a={instagram:{baseUrl:"https://instagram.com/",domains:["instagram.com"],handlePattern:/^@?[\w](?!.*?\.{2})[\w.]{0,28}[\w]$/},facebook:{baseUrl:"https://facebook.com/",domains:["facebook.com","fb.com"],handlePattern:/^@?[a-zA-Z0-9.]{3,}$/},twitter:{baseUrl:"https://twitter.com/",domains:["twitter.com","x.com"],handlePattern:/^@?[a-zA-Z0-9_]{1,15}$/},linkedin:{baseUrl:"https://linkedin.com/in/",domains:["linkedin.com"],handlePattern:/^[a-zA-Z0-9-]{3,100}$/},youtube:{baseUrl:"https://youtube.com/@",domains:["youtube.com","youtu.be"],handlePattern:/^@?[a-zA-Z0-9_-]{3,30}$/},tiktok:{baseUrl:"https://tiktok.com/@",domains:["tiktok.com"],handlePattern:/^@?[a-zA-Z0-9_.]{2,24}$/},snapchat:{baseUrl:"https://snapchat.com/add/",domains:["snapchat.com"],handlePattern:/^[a-zA-Z][a-zA-Z0-9._-]{1,15}$/},whatsapp:{baseUrl:"https://wa.me/",domains:["wa.me","whatsapp.com"],handlePattern:/^\+?[1-9]\d{1,14}$/},calendly:{baseUrl:"https://calendly.com/",domains:["calendly.com"],handlePattern:/^[a-zA-Z0-9-_]{3,30}$/},telegram:{baseUrl:"https://t.me/",domains:["t.me","telegram.com","telegram.me"],handlePattern:/^@?[a-zA-Z0-9_]{5,32}$/},reddit:{baseUrl:"https://reddit.com/u/",domains:["reddit.com"],handlePattern:/^(u\/)?[a-zA-Z0-9_-]{3,20}$/},pinterest:{baseUrl:"https://pinterest.com/",domains:["pinterest.com"],handlePattern:/^[a-zA-Z0-9_]{3,30}$/},zoom:{baseUrl:"",domains:["zoom.us","zoom.com"],handlePattern:null}},s=["com","org","net","edu","gov","co","io","ai","app","dev","uk","us","ca","au","de","fr","in","me","info","biz","ly","it","es","ru","jp","cn","br","mx","id","ph","vn","tv","cc","ws","mobi","online","site","tech","store","xyz"],l=["instagram","facebook","twitter","linkedin","calendly","zoom","snapchat","tiktok","youtube","whatsapp","telegram","reddit","pinterest"];!function(){__async(this,null,function*(){yield function(){return __async(this,null,function*(){try{const e=yield fetch("/api/card/get-client-ip"),t=yield e.json();return t.success?t.ip:null}catch(e){return null}})}()})}();const r=new class{constructor(e=t){this.baseURL=e,this.token=this.getToken()}getUserWithProfile(){return __async(this,null,function*(){return this.apiRequest("/auth/user-profile")})}getToken(){return localStorage.getItem("authToken")||null}setToken(e){this.token=e,localStorage.setItem("authToken",e)}clearToken(){this.token=null,localStorage.removeItem("authToken")}apiRequest(e){return __async(this,arguments,function*(e,t={}){const n=`${this.baseURL}${e}`,o=__spreadValues({headers:__spreadValues({"Content-Type":"application/json"},t.headers),credentials:"include"},t);try{const e=yield fetch(n,o),t=yield e.json();if(!e.ok)throw new Error(t.message||"API request failed");return t}catch(i){throw i}})}checkAuthStatus(){return __async(this,null,function*(){try{return(yield this.apiRequest("/auth/status")).authenticated}catch(e){return!1}})}getCurrentUser(){return __async(this,null,function*(){try{return this.apiRequest("/auth/user-profile")}catch(e){return{success:!1,error:e.message}}})}logout(){return __async(this,null,function*(){try{return yield this.apiRequest("/auth/logout",{method:"POST"}),this.clearToken(),!0}catch(e){return this.clearToken(),!1}})}getProfile(){return __async(this,null,function*(){try{return yield this.apiRequest("/api/profile")}catch(e){return{success:!1,error:e.message}}})}saveProfile(e){return __async(this,null,function*(){return this.apiRequest("/api/profile",{method:"POST",body:JSON.stringify(e)})})}uploadQRCode(e){return __async(this,null,function*(){const t=new FormData;return t.append("qrCode",e),this.apiRequest("/api/profile/upload-qr",{method:"POST",headers:{},body:t})})}updatesuggestions(e){return __async(this,null,function*(){return this.apiRequest("/api/suggestions",{method:"POST",body:JSON.stringify(e)})})}updatecontactinfo(e){return __async(this,null,function*(){return this.apiRequest("/api/contact",{method:"POST",body:JSON.stringify(e)})})}deleteProfile(){return __async(this,null,function*(){return this.apiRequest("/api/profile",{method:"DELETE"})})}getAnalytics(){return __async(this,null,function*(){return this.apiRequest("/api/profile/analytics")})}getPublicCard(e){return __async(this,null,function*(){return this.apiRequest(`/api/card/${e}`)})}getCardhtmlData(e){return __async(this,null,function*(){return this.apiRequest(`/api/card/card-html/${e}`)})}downloadVCard(e){return __async(this,null,function*(){const t=`${this.baseURL}/api/card/${e}/vcard`;window.open(t,"_blank")})}downloadWalletPass(e){return __async(this,null,function*(){const t=`${this.baseURL}/api/card/${e}/wallet-pass`;window.open(t,"_blank")})}getQRCode(e,t=400){return __async(this,null,function*(){return`${this.baseURL}/api/card/${e}/qr?size=${t}`})}getstyledQRCode(e,t=400){return __async(this,null,function*(){return`${this.baseURL}/api/card/${e}/download-styled-qr`})}trackSocialClick(e,t){return __async(this,null,function*(){return this.apiRequest(`/api/card/${e}/track/${t}`,{method:"POST"})})}trackContactClick(e,t){return __async(this,null,function*(){return this.apiRequest(`/api/card/${e}/track/contact/${t}`,{method:"POST"})})}searchCards(e,t=10){return __async(this,null,function*(){return this.apiRequest(`/api/card/search/${encodeURIComponent(e)}?limit=${t}`)})}};function c(e){const t=document.createElement("div");t.style.cssText="\n        position: fixed;\n        bottom: 2rem;\n        right: 2rem;\n        background: #28a745;\n        color: white;\n        padding: 1rem 1.5rem;\n        border-radius: 10px;\n        z-index: 1001;\n        font-weight: 600;\n        box-shadow: 0 10px 25px rgba(40, 167, 69, 0.3);\n        animation: slideInUp 0.3s ease;\n    ",t.textContent=e,document.body.appendChild(t),setTimeout(()=>{t.style.animation="slideOutDown 0.3s ease forwards",setTimeout(()=>t.remove(),300)},3e3)}function d(e){const t=document.createElement("div");t.style.cssText="\n        position: fixed;\n        bottom: 2rem;\n        right: 2rem;\n        background: #dc3545;\n        color: white;\n        padding: 1rem 1.5rem;\n        border-radius: 10px;\n        z-index: 1001;\n        font-weight: 600;\n        box-shadow: 0 10px 25px rgba(220, 53, 69, 0.3);\n    ",t.textContent=e,document.body.appendChild(t),setTimeout(()=>t.remove(),4e3)}function u(e,t){const n=document.getElementById(e);n.style.borderColor="#ee8b46",n.style.backgroundColor="#fff5f5";if(["instagram","facebook","twitter","linkedin","calendly","zoom","snapchat","tiktok","youtube","whatsapp","telegram","reddit","pinterest"].includes(e)){const e=n.closest(".social-item").querySelector(".input-error");e&&(e.innerHTML=`\n                <div class="error-message" style="\n                    color: #ee8b46;\n                    font-size: 0.875rem;\n                    margin-top: 0.5rem;\n                    font-weight: 500;\n                    display: block;\n                    width: 100%;\n                ">${t}</div>\n            `)}else{const e=n.closest(".form-group").querySelector(".error-message");e&&e.remove();const o=document.createElement("div");o.className="error-message",o.style.cssText="\n            color: #ee8b46;\n            font-size: 0.875rem;\n            margin-top: 0.5rem;\n            font-weight: 500;\n            display: block;\n            width: 100%;\n        ",o.textContent=t,n.parentNode.insertBefore(o,n.nextSibling)}}function m(){document.querySelectorAll("#profileForm input, #profileForm textarea").forEach(e=>{e.style.borderColor="",e.style.backgroundColor=""});document.querySelectorAll(".input-error").forEach(e=>{e.innerHTML=""});document.querySelectorAll(".error-message").forEach(e=>e.remove())}function h(){const e=document.querySelectorAll(".error-message"),t=document.querySelectorAll(".input-error:not(:empty)");let n=null;if(e.length>0){const t=e[0];n=t.previousElementSibling||t.parentElement.querySelector("input, textarea, select")}if(!n&&t.length>0){const e=t[0].closest(".social-item");n=e?e.querySelector("input"):null}n&&(n.scrollIntoView({behavior:"smooth",block:"center"}),setTimeout(()=>{n.focus(),n.style.animation="shake 0.5s",setTimeout(()=>{n.style.animation=""},500)},300))}const y=Object.freeze(Object.defineProperty({__proto__:null,clearAllErrors:m,scrollToFirstError:h,showError:u,showErrorMessage:d,showSuccessMessage:c},Symbol.toStringTag,{value:"Module"})),g={CLIENT_SALT:"qrmypro-secure-salt-2025",ITERATIONS:1e4,KEY_SIZE:256,hashPassword(e){return __async(this,null,function*(){if(!e)throw new Error("Password cannot be empty");try{if("undefined"!=typeof CryptoJS){return CryptoJS.PBKDF2(e,this.CLIENT_SALT,{keySize:this.KEY_SIZE/32,iterations:this.ITERATIONS,hasher:CryptoJS.algo.SHA256}).toString(CryptoJS.enc.Hex)}const t=new TextEncoder,n=t.encode(e),o=t.encode(this.CLIENT_SALT),i=yield crypto.subtle.importKey("raw",n,{name:"PBKDF2"},!1,["deriveBits"]),a=yield crypto.subtle.deriveBits({name:"PBKDF2",salt:o,iterations:this.ITERATIONS,hash:"SHA-256"},i,this.KEY_SIZE),s=Array.from(new Uint8Array(a));return s.map(e=>e.toString(16).padStart(2,"0")).join("")}catch(t){throw new Error("Failed to hash password on client side")}})},validatePasswordStrength(e){const t={length:e.length>=8,uppercase:/[A-Z]/.test(e),lowercase:/[a-z]/.test(e),number:/[0-9]/.test(e),special:/[@$!%*?&#]/.test(e)},n=Object.values(t).filter(e=>e).length;let o="weak";return n>=5?o="strong":n>=3&&(o="medium"),{isValid:5===n,requirements:t,strength:o,validCount:n}},generateSecureToken(e=32){try{const t=new Uint8Array(e);return crypto.getRandomValues(t),Array.from(t,e=>e.toString(16).padStart(2,"0")).join("")}catch(t){throw new Error("Failed to generate secure token")}},checkAvailability:()=>({cryptoJS:"undefined"!=typeof CryptoJS,webCrypto:"undefined"!=typeof crypto&&void 0!==crypto.subtle,available:"undefined"!=typeof CryptoJS||"undefined"!=typeof crypto&&void 0!==crypto.subtle}),initialize(){return __async(this,null,function*(){try{if(!this.checkAvailability().available)return!1;yield this.hashPassword("test");return!0}catch(e){return!1}})}};"undefined"!=typeof window&&(window.CryptoHelper=g);let p=null,f=null;function v(e){p=e}function w(e){f=e}function b(){return p}function E(){return f}function C(){return __async(this,null,function*(){window.location.href=`${r.baseURL}/auth/google`})}function I(){return __async(this,null,function*(){window.location.href=`${r.baseURL}/auth/google`})}function L(){return __async(this,null,function*(){try{(yield r.logout())&&($("#navbarAvatar").css("display","none"),$("#navbarAvatarDesktop").css("display","none"),p=null,f=null,k(),S(),J("home"),c("Successfully logged out!"),$("#footer-cta").removeClass("display-none-cta-button"),$("#footer-cta").addClass("cta-section"),$("#singup-cta-button-div-uc").removeClass("display-none-cta-button"),$("#singup-cta-button-div-uc").addClass("usecase-cta"))}catch(e){d("Error logging out. Please try again.")}})}function k(){document.getElementById("authNav");const e=document.getElementById("loginBtn"),t=document.getElementById("signupBtn"),n=document.getElementById("profileBtn"),o=document.getElementById("displayBtn"),i=document.getElementById("walletBtn"),a=document.getElementById("logoutBtn"),s=document.getElementById("faqBtn");null==s||s.classList.remove("hidden"),p?(null==e||e.classList.add("hidden"),null==t||t.classList.add("hidden"),null==n||n.classList.remove("hidden"),null==o||o.classList.remove("hidden"),null==i||i.classList.remove("hidden"),null==a||a.classList.remove("hidden")):(null==e||e.classList.remove("hidden"),null==t||t.classList.remove("hidden"),null==n||n.classList.add("hidden"),null==o||o.classList.add("hidden"),null==i||i.classList.add("hidden"),null==a||a.classList.add("hidden"))}function S(){const e=document.getElementById("loginBtnMobile"),t=document.getElementById("signupBtnMobile"),n=document.getElementById("profileBtnMobile"),o=document.getElementById("displayBtnMobile"),i=document.getElementById("walletBtnMobile"),a=document.getElementById("logoutBtnMobile"),s=document.getElementById("faqBtnMobile");null==s||s.classList.remove("hidden"),p?(null==e||e.classList.add("hidden"),null==t||t.classList.add("hidden"),null==n||n.classList.remove("hidden"),null==o||o.classList.remove("hidden"),null==i||i.classList.remove("hidden"),null==a||a.classList.remove("hidden")):(null==e||e.classList.remove("hidden"),null==t||t.classList.remove("hidden"),null==n||n.classList.add("hidden"),null==o||o.classList.add("hidden"),null==i||i.classList.add("hidden"),null==a||a.classList.add("hidden"))}const B={baseURL:window.location.origin,initialize(){return __async(this,null,function*(){if(!window.CryptoHelper)return!1;return!!(yield window.CryptoHelper.initialize())})},signup(e,t,n){return __async(this,null,function*(){const o=yield g.hashPassword(t),i=yield fetch(`${this.baseURL}/auth/signup`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({email:e,password:o,name:n})});return yield i.json()})},verifyEmail(e,t){return __async(this,null,function*(){const n=yield fetch(`${this.baseURL}/auth/verify-email`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({email:e,code:t})});return yield n.json()})},resendVerification(e){return __async(this,null,function*(){const t=yield fetch(`${this.baseURL}/auth/resend-verification`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({email:e})});return yield t.json()})},login(e,t){return __async(this,null,function*(){const n=yield g.hashPassword(t),o=yield fetch(`${this.baseURL}/auth/login`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({email:e,password:n})});return yield o.json()})},forgotPassword(e){return __async(this,null,function*(){const t=yield fetch(`${this.baseURL}/auth/forgot-password`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({email:e})});return yield t.json()})},resetPassword(e,t){return __async(this,null,function*(){const n=yield g.hashPassword(t),o=yield fetch(`${this.baseURL}/auth/reset-password`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({token:e,password:n})});return yield o.json()})}};function _(e){let t=0;const n={length:e.length>=8,uppercase:/[A-Z]/.test(e),lowercase:/[a-z]/.test(e),number:/[0-9]/.test(e),special:/[@$!%*?&#]/.test(e)};Object.keys(n).forEach(e=>{const o=document.getElementById(`req-${e}`);o&&(n[e]?(o.classList.add("valid"),t++):o.classList.remove("valid"))});const o=document.getElementById("strengthBarFill"),i=document.getElementById("strengthText");return o&&i&&(o.className="strength-bar-fill",t<=2?(o.classList.add("weak"),i.textContent="Weak password",i.style.color="#e74c3c"):t<=4?(o.classList.add("medium"),i.textContent="Medium password",i.style.color="#f39c12"):(o.classList.add("strong"),i.textContent="Strong password",i.style.color="#27ae60")),n}function P(e){let t=0;const n={length:e.length>=8,uppercase:/[A-Z]/.test(e),lowercase:/[a-z]/.test(e),number:/[0-9]/.test(e),special:/[@$!%*?&#]/.test(e)};Object.keys(n).forEach(e=>{const o=document.getElementById(`req-newpass-${e}`);o&&(n[e]?(o.classList.add("valid"),t++):o.classList.remove("valid"))});const o=document.getElementById("strengthBarFillnewpass"),i=document.getElementById("strengthTextnewpass");return o&&i&&(o.className="strength-bar-fill-newpass",t<=2?(o.classList.add("weak"),i.textContent="Weak password",i.style.color="#e74c3c"):t<=4?(o.classList.add("medium"),i.textContent="Medium password",i.style.color="#f39c12"):(o.classList.add("strong"),i.textContent="Strong password",i.style.color="#27ae60")),n}function x(){return __async(this,null,function*(){try{const e=$("#loginEmail").val().trim(),t=$("#loginPassword").val().trim(),n=yield B.login(e,t);if(n.success){n.token&&(localStorage.setItem("authToken",n.token),r.setToken(n.token)),c("Login successful."),document.getElementById("loginEmail").value="",document.getElementById("loginPassword").value="";const e=yield r.getCurrentUser(),t=yield r.getProfile();if(e.success&&t.success&&t.profile){v(e.user);w(t.profile),k(),S(),window.verticalNav&&window.verticalNav.updateAuthUI&&window.verticalNav.updateAuthUI(e.user),J("display"),function(){__async(this,null,function*(){const e=new URLSearchParams(window.location.search),t=e.get("redirectToWallet");if("login"===e.get("page")&&("true"==t||t)){const e=sessionStorage.getItem("pendingWalletCard");if(e){const t=yield fetch(`/api/wallet/add/${e}`,{method:"POST",credentials:"include"}),n=yield t.json();if(!n.success)throw new Error(n.message||"Failed to add card");c("Card added to your wallet! You can view it in the Wallet tab."),setTimeout(()=>{},1e3),window.open("/wallet")}else window.open("/login")}})}()}else d("Issue while getting current user")}else n.useGoogleOAuth?(d("This account uses Google Sign-In"),setTimeout(()=>C(),2e3)):n.emailNotVerified?(d("Please verify your email first"),sessionStorage.setItem("verificationEmail",e),setTimeout(()=>J("emailVerification"),2e3)):d(n.message||"Login failed")}catch(e){d("Network error. Please try again.")}})}$(document).on("click","#signinbackbtn",function(){J("login")}),$(document).on("click",".loginbutton",function(){J("login")}),$(document).on("click","#backsignupbtn",function(){J("signup")}),$(document).on("click","#signupbutton",function(){J("signup")}),$(document).on("click",".forgot-link",function(){J("forgotPassword")}),$(document).on("click","#forgotBtn",function(){return __async(this,null,function*(){const e=document.getElementById("forgotPasswordForm"),t=new FormData(e).get("email").trim().toLowerCase();try{const e=yield B.forgotPassword(t);e&&e.success?(c("Check your email."),J("login")):(d("Error while sending reset link"),J("login"))}catch(n){d("Error while sending reset link: "+n.message),J("login")}})}),$(document).on("click",".toggle-password",function(){const e=$(this),t=e.data("passtype"),n=$("#"+t),o=e.find("i");"password"===n.attr("type")?(n.attr("type","text"),o.removeClass("fa-eye").addClass("fa-eye-slash")):(n.attr("type","password"),o.removeClass("fa-eye-slash").addClass("fa-eye"))}),$(document).on("click","#resetBtn",function(){return __async(this,null,function*(){try{const e=document.getElementById("confirmPassword"),t=document.getElementById("newPassword"),n=e.value.trim(),o=t.value.trim();if(n===o)if(o&&n){const e=function(e){const t=`; ${document.cookie}`.split(`; ${e}=`);return 2===t.length?t.pop().split(";").shift():null}("passResetToken");if(e){const t=yield B.resetPassword(e,n);t&&t.success?(c("Password Reset Successfully"),J("login"),document.getElementById("newPassword").value="",document.getElementById("confirmPassword").value=""):(d("Network Error"),J("login"))}else d("Token is expired sp request again."),J("login")}else d("Empty Values");else d("Password and confirm password are not matching")}catch(e){}})}),document.addEventListener("DOMContentLoaded",function(){return __async(this,null,function*(){try{if(document.getElementById("resetPasswordForm")){const e=document.getElementById("confirmPassword"),t=document.getElementById("newPassword");let n;if(e&&e.addEventListener("input",e=>{const t=P(e.target.value);n=Object.values(t).every(e=>!0===e)}),t&&t.addEventListener("input",e=>{const t=P(e.target.value);n=Object.values(t).every(e=>!0===e)}),!n)return void(document.getElementById("passwordErrornewpass").textContent="Please meet all password requirements")}}catch(e){}})}),document.addEventListener("DOMContentLoaded",function(){const e=document.getElementById("emailSignupForm");if(e){const t=document.getElementById("signupPassword");t&&t.addEventListener("input",e=>{_(e.target.value)}),e.addEventListener("submit",t=>__async(this,null,function*(){t.preventDefault();const n=document.getElementById("createaccountBtn"),o=n.innerHTML;document.querySelectorAll(".error-message").forEach(e=>e.textContent="");const i=new FormData(e),a=i.get("name").trim(),s=i.get("email").trim().toLowerCase(),l=i.get("password"),r=_(l);if(Object.values(r).every(e=>!0===e)){n.disabled=!0,n.innerHTML='<i class="fas fa-spinner fa-spin"></i> Creating Account...';try{const e=yield B.signup(s,l,a);if(e.success)if(sessionStorage.setItem("verificationEmail",s),e.redirectToVerification){if(e.codeResent)c("New verification code sent! Please check your email.");else if(e.codeExpiresIn){c(`Verification code already sent! Valid for ${Math.floor(e.codeExpiresIn/60)} more minutes.`)}else c("Account created! Please check your email for verification code.");setTimeout(()=>{document.getElementById("verificationEmail").textContent=s,J("emailVerification")},1500)}else c("Account created! Please check your email for verification code."),setTimeout(()=>{document.getElementById("verificationEmail").textContent=s,J("emailVerification")},1500);else e.useGoogleOAuth?(d("Gmail accounts must use Google Sign-In"),setTimeout(()=>C(),2e3)):e.redirectToLogin?(d(e.message||"Account already exists. Please login."),setTimeout(()=>J("emailLoginPage"),2e3)):(d(e.message||"Signup failed"),e.message&&e.message.includes("email")&&(document.getElementById("emailError").textContent=e.message))}catch(u){d("Network error. Please try again.")}finally{n.disabled=!1,n.innerHTML=o}}else document.getElementById("passwordError").textContent="Please meet all password requirements"}))}}),document.addEventListener("DOMContentLoaded",function(){const e=document.getElementById("emailVerificationForm");if(e){const t=document.getElementById("verificationCode");t&&(t.addEventListener("input",e=>{e.target.value=e.target.value.replace(/\D/g,"").substring(0,6)}),t.addEventListener("input",n=>{6===n.target.value.length&&setTimeout(()=>{6===t.value.length&&e.dispatchEvent(new Event("submit"))},500)})),e.addEventListener("submit",e=>__async(this,null,function*(){e.preventDefault();const t=document.getElementById("verifyBtn"),n=t.innerHTML;document.getElementById("codeError").textContent="";const o=document.getElementById("verificationCode").value.trim(),i=sessionStorage.getItem("verificationEmail");if(o&&6===o.length){if(!i)return d("Session expired. Please sign up again."),void J("emailSignupPage");t.disabled=!0,t.innerHTML='<i class="fas fa-spinner fa-spin"></i> Verifying...';try{const e=yield B.verifyEmail(i,o);e.success?(c("Email verified successfully! Redirecting..."),sessionStorage.removeItem("verificationEmail"),e.token&&(localStorage.setItem("authToken",e.token),r.setToken(e.token)),$("#signupName").empty(),$("#signupEmail").empty(),$("#signupPassword").empty(),document.getElementById("signupName").value="",document.getElementById("signupEmail").value="",document.getElementById("signupPassword").value="",window.verticalNav&&window.verticalNav.checkAuth&&(yield window.verticalNav.checkAuth()),setTimeout(()=>{window.location.href="/?page=profile"},1e3)):(e.expired?(d("Verification code expired. Please request a new one."),document.getElementById("codeError").textContent="Code expired"):(d(e.message||"Invalid verification code"),document.getElementById("codeError").textContent=e.message||"Invalid code"),document.getElementById("verificationCode").value="",document.getElementById("verificationCode").focus())}catch(a){d("Network error. Please try again."),document.getElementById("codeError").textContent="Network error"}finally{t.disabled=!1,t.innerHTML=n}}else document.getElementById("codeError").textContent="Please enter a valid 6-digit code"}))}}),$(document).on("click","#resendverification",function(){return __async(this,null,function*(){yield function(){return __async(this,null,function*(){const e=sessionStorage.getItem("verificationEmail");if(!e)return d("Session expired. Please sign up again."),void J("signup");try{const t=yield B.resendVerification(e);t.success?c("Verification code sent!"):d(t.message||"Failed to resend code")}catch(t){d("Network error. Please try again.")}})}()})}),$(document).on("click","#signinBtn",function(){return __async(this,null,function*(){yield x()})}),$(document).ready(function(){$("#loginPassword").on("keypress",function(e){return __async(this,null,function*(){13!==e.which&&13!==e.keyCode||(e.preventDefault(),yield x())})})});const T=document.createElement("style");T.textContent="\n  @keyframes slideInRight {\n    from {\n      transform: translateX(100%);\n      opacity: 0;\n    }\n    to {\n      transform: translateX(0);\n      opacity: 1;\n    }\n  }\n\n  @keyframes slideOutRight {\n    from {\n      transform: translateX(0);\n      opacity: 1;\n    }\n    to {\n      transform: translateX(100%);\n      opacity: 0;\n    }\n  }\n",document.head.appendChild(T);const A=Object.freeze(Object.defineProperty({__proto__:null,get currentUser(){return p},getCurrentUser:b,getUserProfile:E,getUserStatus:function(){return __async(this,null,function*(){try{return yield $.ajax({url:"auth/status",method:"GET",dataType:"json"})}catch(e){}})},loginWithGoogle:C,logout:L,setCurrentUser:v,setUserProfile:w,signupWithGoogle:I,updateAuthUI:k,updateAuthUImobilebuttons:S,get userProfile(){return f}},Symbol.toStringTag,{value:"Module"}));function R(){return"QRP-"+Date.now()+"-"+Math.random().toString(36).substr(2,9)}function q(){return"auth-"+Math.random().toString(36).substr(2,15)}function U(){const e=document.getElementById("wallet-loader");e&&e.remove()}function M(){return __async(this,null,function*(){const t=document.querySelector(".copy-url-btn"),n=$(t).data("personal-card-url");try{navigator.clipboard&&window.isSecureContext?yield navigator.clipboard.writeText(n):(urlInput.select(),document.execCommand("copy"));const o=t.textContent;t.textContent="Copied!",t.style.background="#28a745",setTimeout(()=>{t.textContent=o,t.style.background="transparent"},2e3);const{showSuccessMessage:i}=yield e(()=>__async(this,null,function*(){const{showSuccessMessage:e}=yield Promise.resolve().then(()=>y);return{showSuccessMessage:e}}));i("Card URL copied to clipboard!")}catch(o){const{showErrorMessage:t}=yield e(()=>__async(this,null,function*(){const{showErrorMessage:e}=yield Promise.resolve().then(()=>y);return{showErrorMessage:e}}));t("Failed to copy URL. Please copy manually.")}})}function D(){return __async(this,null,function*(){if(confirm("Are you sure you want to remove your profile photo?"))try{(yield $.ajax({url:"/api/profile/delete-profile-photo",method:"DELETE",headers:{Authorization:"Bearer "+localStorage.getItem("token")}})).success&&(c("Profile photo removed successfully!"),$("#profilePhotoImg").hide(),$("#avatarDisplay").show(),$("#deletePhotoBtn").hide(),$("#profilePhotoInput").val(""),yield G())}catch(e){d("Error removing photo")}})}function O(){$("#uploadPhotoBtn").on("click",function(){$("#profilePhotoInput").click()}),$("#profilePhotoInput").on("change",function(e){return __async(this,null,function*(){const t=e.target.files[0];if(!t)return;if(t.size>n)return d("File size must be less than 5MB"),void $(this).val("");const o=t.name.toLowerCase(),i=o.endsWith(".heic")||o.endsWith(".heif");if(!t.type.startsWith("image/")&&!i)return d("Please select an image file (JPG, PNG, GIF, HEIC)"),void $(this).val("");if(i)$("#avatarDisplay").show(),$("#profilePhotoImg").hide();else{const e=new FileReader;e.onload=function(e){$("#profilePhotoImg").attr("src",e.target.result).show(),$("#avatarDisplay").hide()},e.readAsDataURL(t)}yield function(e){return __async(this,null,function*(){var t;const n=new FormData;n.append("profilePhoto",e);const o=e.name.toLowerCase().endsWith(".heic")||e.name.toLowerCase().endsWith(".heif"),i=$("#uploadPhotoBtn"),a=i.html();i.prop("disabled",!0).text(o?"Converting & Uploading...":"Uploading...");try{(yield $.ajax({url:"/api/profile/upload-profile-photo",method:"POST",data:n,processData:!1,contentType:!1,headers:{Authorization:"Bearer "+localStorage.getItem("token")}})).success&&(c("Profile photo uploaded successfully!"),$("#deletePhotoBtn").show(),i.prop("disabled",!1).html(a),yield G())}catch(s){d((null==(t=s.responseJSON)?void 0:t.message)||"Error uploading photo"),$("#profilePhotoImg").hide(),$("#avatarDisplay").show(),$("#profilePhotoInput").val(""),i.prop("disabled",!1).html(a)}})}(t)})}),$("#deletePhotoBtn").on("click",D)}function N(){return __async(this,null,function*(){const e=E();if(e)try{if(yield function(e){return __async(this,null,function*(){const t=document.querySelector(".userprofile-dynamic-html");t.innerHTML="Loading...";try{let n=yield r.getCardhtmlData(e);const o=yield n;o.success?t.innerHTML=o.html:t.innerHTML="Error: "+o.message}catch(n){t.innerHTML="Failed to load card"}})}(e.slug),e.cardId){const t=e.slug||e.cardId,n=`${window.location.origin}/card/${t}`,o=yield r.getQRCode(t);document.getElementById("generatedQR").innerHTML=`\n                <div class="qr-buttons-heading"><h2>QR For Promotion,Share,Advertise</h2></div>\n                <div class="profile-qrcode-div">\n                    <div class="profile-qrcode-image-div">\n                        <img src="${o}" alt="QR Code" class="qr-preview" style="border-radius: 10px;">\n                        \n                    </div>\n                    <div class="Download-qrcode-buttons">\n                        <button class="profile-card-buttons" id="downloadVCard-btn-dynamic">\n                             <i class="fa-regular fa-floppy-disk"></i>\n                            Save Contact\n                        </button>\n                        <button class="profile-card-buttons" id="downloadQRCode-btn-dynamic">\n                            <i class="fa-regular fa-address-card"></i>\n                            Download Digital Card\n                        </button>\n                        <button class="profile-card-buttons" id="downloadonlyQRCode-btn-dynamic">\n                            <i class="fas fa-qrcode"></i>\n                            Download Only QR Code\n                        </button>\n                        <button class="profile-card-buttons hidden" id="addToWallet-btn">\n                            <i class="fas fa-mobile-alt"></i>\n                            Add to Wallet\n                        </button>\n                        <button data-personal-card-url="${n}" class="profile-card-buttons copy-url-btn">\n                            <i class="fa-regular fa-copy"></i> Copy Digital Card URL\n                        </button>\n                    </div>\n                </div>\n                \n                \n            `}$("#navbarAvatar").show(),$("#navbarAvatarDesktop").show(),$(".card-actions").appendTo("#Download-qrcode-buttons")}catch(t){}})}function W(){return __async(this,null,function*(){try{const e=E();e&&e.cardId&&(yield r.downloadVCard(e.cardId),c("vCard download started!"))}catch(e){d("Failed to download vCard")}})}function z(e,t=null){return __async(this,null,function*(){try{c("Preparing wallet card...");const n=yield fetch(`${r.baseURL}/api/card/${e}/wallet-card-data`),o=yield n.json();if(!o.success)throw new Error(o.message||"Failed to fetch card data");const i=o.data,a=function(e){r.baseURL,e.qrUrl,r.baseURL,e.cardUrl,e.cardId&&(r.baseURL,e.cardId);let t="";if(e.hasProfilePhoto){t=`<div class="wallet-card-avatar-overlap"><img src="${`${r.baseURL}/api/profile/photo/c/${e.cardId}`}" \n                           alt="${j(e.name)}" \n                           crossorigin="anonymous"\n                           onerror="this.style.display='none'; this.parentElement.innerHTML='<span>${e.initials}</span>';"></div>`}else t=` <div class="wallet-card-avatar-download"><span>${e.initials}</span></div>`;let n=j(e.name);j(e.organization)&&(n=j(e.organization));return`<div class="digital-wallet-card" data-card-id="g0czadibq">\n      \n            \n    \x3c!-- Colored Header Section --\x3e\n    <div class="wallet-card-header-section">\n        <div class="wallet-card-brand-name">${n}</div>\n       \n            ${t}\n       \n        \x3c!-- Overlapping Profile Photo --\x3e\n        \n    </div>\n    \n    \x3c!-- Content Section --\x3e\n    <div class="wallet-card-content">\n        <div class="empty-div"><div class="wallet-qr-top-container">\n            <img src="/card/${j(e.slug)}/qr" alt="QR Code for ${j(e.name)}">\n        </div></div>\n        <div class="actual-content">\n        <div class="wallet-card-name">${j(e.name)}</div>\n        \n        <div class="wallet-card-email"><a href="mailto:${j(e.email)}" class="wallet-display-email" title="Email">${j(e.email)}</a></div>\n  \n        </div>\n    </div>\n    \n    <div class="digital-card-action-btn-style">\n        <div class="logo">\n            <img src="./image/app-logo.png" alt="QRprofile Logo" class="card-logo-image-only">\n        </div>\n        <span>PoweredBy:${window.location.href} </span>\n    </div>\n </div>`}(i),s=document.createElement("div");s.style.position="absolute",s.style.left="-9999px",s.style.top="0",s.style.opacity="0",s.style.pointerEvents="none",s.innerHTML=a,document.body.appendChild(s),yield function(e){const t=e.querySelectorAll("img"),n=Array.from(t).map((e,t)=>new Promise(t=>{e.complete&&0!==e.naturalHeight?t():(e.onload=()=>{t()},e.onerror=n=>{e.style.display="none",t()},setTimeout(()=>{t()},1e4))}));return Promise.all(n)}(s);const l=s.querySelector(".digital-wallet-card");l.style.display="block";window.getComputedStyle(l);const d=yield function(e){return __async(this,null,function*(){if("undefined"==typeof html2canvas)throw new Error("html2canvas library is not loaded");e.getBoundingClientRect();const t=yield html2canvas(e,{backgroundColor:"#ffffff",scale:2,useCORS:!0,allowTaint:!1,logging:!0,imageTimeout:15e3,width:e.offsetWidth,height:e.offsetHeight+20,windowWidth:e.offsetWidth,windowHeight:e.offsetHeight});return new Promise(e=>{t.toBlob(e,"image/png",1)})})}(l);!function(e,t){const n=URL.createObjectURL(e),o=document.createElement("a");o.href=n,o.download=t,document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(n)}(d,t||`${i.name.replace(/\s+/g,"-")}-WalletCard.png`),document.body.removeChild(s),c("Wallet card downloaded successfully!")}catch(n){throw d("Failed to download wallet card: "+n.message),n}})}function j(e){if(!e)return"";const t=document.createElement("div");return t.textContent=e,t.innerHTML}function F(){return __async(this,null,function*(){try{const e=E();e&&e.cardId&&(yield z(e.cardId))}catch(e){d("Failed to download QR code")}})}function H(){return __async(this,null,function*(){try{const e=E(),t=yield r.getQRCode(e.slug),n=yield fetch(t),o=yield n.blob(),i=window.URL.createObjectURL(o),a=document.createElement("a");a.href=i,a.download=`qr-${e.slug}.png`,document.body.appendChild(a),a.click(),document.body.removeChild(a),window.URL.revokeObjectURL(i)}catch(e){d("Failed to download styled QR card")}})}const Q=Object.freeze(Object.defineProperty({__proto__:null,downloadQRCode:F,downloadStyledQRCard:H,downloadVCard:W,trackContactClick:function(e){return __async(this,null,function*(){const t=E();t&&t.cardId&&(yield r.trackContactClick(t.cardId,e))})},trackSocialClick:function(e){return __async(this,null,function*(){const t=E();t&&t.cardId&&(yield r.trackSocialClick(t.cardId,e))})},updateDisplayPage:N},Symbol.toStringTag,{value:"Module"}));function V(){return __async(this,null,function*(){var e,t,n,o,i,a,s,l;try{!function(e){const t=document.getElementById("loadingMessage");t&&t.remove();const n=document.createElement("div");n.id="loadingMessage",n.style.cssText="\n        position: fixed;\n        top: 50%;\n        left: 50%;\n        transform: translate(-50%, -50%);\n        background: rgba(102, 126, 234, 0.95);\n        color: white;\n        padding: 2rem 3rem;\n        border-radius: 15px;\n        z-index: 2000;\n        font-weight: 600;\n        text-align: center;\n        backdrop-filter: blur(10px);\n        box-shadow: 0 20px 40px rgba(0,0,0,0.3);\n    ",n.innerHTML=`\n        <div style="margin-bottom: 1rem;">⏳</div>\n        <div>${e}</div>\n    `,document.body.appendChild(n)}("Saving profile and generating QR codes...");const d=document.getElementById("profileForm");if(!d)throw new Error("Profile form not found");const u={};["instagram","facebook","twitter","linkedin","calendly","zoom","snapchat","tiktok","youtube","whatsapp","telegram","reddit","pinterest"].forEach(e=>{const t=document.getElementById(e);if(t){const n=t.getAttribute("data-final-url");n&&n.trim()&&(u[e]=n)}});const m=new FormData(d),h=window.locationAutocomplete?window.locationAutocomplete.getSelectedLocation():null,y={name:m.get("name"),title:m.get("title"),organization:m.get("organization"),phone:m.get("phone"),mobile:m.get("mobile"),email:m.get("email"),website:m.get("website"),address:m.get("address"),notes:m.get("notes"),showPhoneNumber:$("#showPhoneNumber").is(":checked"),country:{name:(null==(e=null==h?void 0:h.country)?void 0:e.name)||m.get("country")||"",code:m.get("countryCode")||(null==(t=null==h?void 0:h.country)?void 0:t.code)||""},state:{name:(null==(n=null==h?void 0:h.state)?void 0:n.name)||m.get("state")||"",id:m.get("stateId")||(null==(o=null==h?void 0:h.state)?void 0:o.id)||"",code:m.get("stateCode")||(null==(i=null==h?void 0:h.state)?void 0:i.code)||""},city:{name:(null==(a=null==h?void 0:h.city)?void 0:a.name)||m.get("city")||"",id:m.get("cityId")||(null==(s=null==h?void 0:h.city)?void 0:s.id)||""},socialMedia:u,isPublic:$("#isPublic").is(":checked")},g=yield r.saveProfile(y);if(!g.success)throw new Error(g.message||"Save failed");{w(g.profile);let e="Profile saved successfully!";g.qrGenerated&&(e+=` Generated ${(null==(l=g.qrCodes)?void 0:l.length)||0} QR codes.`),c(e),N(),$(".profile-photo-section").show(),setTimeout(()=>{J("display")},1500)}}catch(u){d("Failed to save profile: "+u.message)}finally{!function(){const e=document.getElementById("loadingMessage");e&&e.remove()}()}})}function G(){return __async(this,null,function*(){var e,t,n;try{const o=yield r.getUserWithProfile();if(o.success&&o.profile){const i=o.profile;w(i),document.getElementById("email").value=o.profile.email,void 0!==i.showPhoneNumber&&(document.getElementById("showPhoneNumber").checked=i.showPhoneNumber);const a=document.getElementById("profileForm");if(a){a.querySelectorAll("input, textarea").forEach(e=>{const t=e.name;"country"!==t&&"state"!==t&&"city"!==t&&(t&&void 0!==i[t]?e.value=i[t]:t&&i.socialMedia&&void 0!==i.socialMedia[t]&&(e.value=i.socialMedia[t]))})}if((null==(e=i.country)?void 0:e.name)&&(document.getElementById("country").value=i.country.name,document.getElementById("countryCode").value=i.country.code||"",window.locationAutocomplete)){const e=window.locationAutocomplete.countries.find(e=>e.code===i.country.code);e&&window.locationAutocomplete.selectCountry(e)}if((null==(t=i.state)?void 0:t.name)&&setTimeout(()=>{if(document.getElementById("state").value=i.state.name,document.getElementById("stateId").value=i.state.id||"",document.getElementById("stateCode").value=i.state.code||"",window.locationAutocomplete&&window.locationAutocomplete.selectedCountry){const e=window.locationAutocomplete.currentStates.find(e=>e.id===i.state.id);e&&window.locationAutocomplete.selectState(e)}},500),(null==(n=i.city)?void 0:n.name)&&setTimeout(()=>{document.getElementById("city").value=i.city.name,document.getElementById("cityId").value=i.city.id||""},1e3),i.uploadedQR&&i.uploadedQR.url){const e=document.getElementById("qrPreview"),t=document.getElementById("qrUploadText");e&&t&&(e.src=r.baseURL+i.uploadedQR.url,e.classList.remove("hidden"),t.innerHTML="QR Code uploaded ✅<br><small>Click to change</small>")}!function(e){const t=$("#avatarDisplay"),n=$("#avatarInitials"),o=$("#profilePhotoImg"),i=$("#deletePhotoBtn");e.hasProfilePhoto?(o.attr("src",`/api/profile/photo/c/${e.cardId}`),o.show(),t.hide(),i.show()):(n.text(e.initials),t.show(),o.hide(),i.hide())}(i),function(e){let t=$(".navbar-avatar");0===t.length&&(t=$('<div class="navbar-avatar"></div>'),$("#logoutBtn").after(t)),t.empty(),e.hasProfilePhoto?t.html(`<img src="/api/profile/photo/c/${e.cardId}" alt="Profile">`):t.text(e.initials),t.off("click").on("click",function(){})}(i)}else if(o.success&&!o.profile){w(null);const e=yield r.getCurrentUser();1==e.success&&(document.getElementById("email").value=e.user.email)}else J("login")}catch(o){o.message.includes("retrieving profile")?d("Unable to load your profile. Please try refreshing the page."):d("Profile loading error: "+o.message)}})}function J(e){return __async(this,null,function*(){if(!b()&&("profile"===e||"display"===e||"wallet"===e))return J("home"),void d("Please log in to access Profile and Card page");document.querySelectorAll(".page").forEach(e=>{e.classList.remove("active"),e.style.display="none"});const t=document.getElementById(e+"Page");t&&(t.classList.add("active"),t.style.display="block","profile"===e?G():"display"===e?N():"wallet"===e&&"function"==typeof loadWalletCards&&loadWalletCards())})}function Z(){return __async(this,null,function*(){const t=new URLSearchParams(window.location.search);if(!t.toString())return J("display"),null;const n={};for(const[e,o]of t.entries())n[e]=o;if(t.has("page")){const{getUserStatus:o}=yield e(()=>__async(this,null,function*(){const{getUserStatus:e}=yield Promise.resolve().then(()=>A);return{getUserStatus:e}})),i=t.get("page"),a={home:"home",faq:"faq",usecase:"usecase",scenario:"usecase",resetPassword:"resetPassword"};if(a[i])return J(a[i]),n;if(["signup","login","profile","wallet"].includes(i)){const e=yield o();e&&e.authenticated?J("signup"===i||"login"===i?"display":i):J("profile"===i||"wallet"===i?"login":i)}}return n})}function K(){!function(){const e=document.querySelectorAll(".sidebar .nav-item");e.forEach(t=>{t.addEventListener("click",function(t){t.preventDefault();const n=this.getAttribute("data-page");n&&(e.forEach(e=>e.classList.remove("active")),this.classList.add("active"),J(n),oe(n),Y(),window.scrollTo(0,0))})})}(),function(){const e=document.getElementById("mobileMenuToggle"),t=document.querySelector(".sidebar");e&&t&&(e.addEventListener("click",function(){t.classList.toggle("mobile-open");const e=this.querySelector("i");t.classList.contains("mobile-open")?(e.classList.remove("fa-bars"),e.classList.add("fa-times")):(e.classList.remove("fa-times"),e.classList.add("fa-bars"))}),document.addEventListener("click",function(n){window.innerWidth<=768&&(t.contains(n.target)||e.contains(n.target)||Y())}))}(),X(),function(){const e=new URLSearchParams(window.location.search).get("page");if(e)ie(e);else{ie(b()?"display":"home")}}()}function Y(){if(window.innerWidth<=768){const e=document.querySelector(".sidebar"),t=document.getElementById("mobileMenuToggle");if(e&&t){e.classList.remove("mobile-open");const n=t.querySelector("i");n&&(n.classList.remove("fa-times"),n.classList.add("fa-bars"))}}}function X(){return __async(this,null,function*(){try{const e=b();if(e)ee(e);else{if(yield r.checkAuthStatus()){const e=yield r.getCurrentUser();e.success&&e.user?ee(e.user):te()}else te()}}catch(e){te()}})}function ee(e){const t=document.getElementById("loginBtnSidebar"),n=document.getElementById("signupBtnSidebar"),o=document.getElementById("profileBtnSidebar"),i=document.getElementById("displayBtnSidebar"),a=document.getElementById("walletBtnSidebar"),s=document.getElementById("logoutBtnSidebar"),l=document.getElementById("userProfileSection");if(t&&t.classList.add("hidden"),n&&n.classList.add("hidden"),o&&o.classList.remove("hidden"),i&&i.classList.remove("hidden"),a&&a.classList.remove("hidden"),s&&(s.style.display="flex"),l){l.style.display="flex";const t=document.getElementById("sidebarUserName"),n=document.getElementById("sidebarUserEmail"),o=document.getElementById("sidebarUserInitials");if(t&&(t.textContent=e.name||e.email||"User"),n&&(n.textContent=e.email||""),o&&(e.name||e.email)){const t=(e.name||e.email).split(" ").map(e=>e[0]).join("").toUpperCase().substring(0,2);o.textContent=t}}}function te(){const e=document.getElementById("loginBtnSidebar"),t=document.getElementById("signupBtnSidebar"),n=document.getElementById("profileBtnSidebar"),o=document.getElementById("displayBtnSidebar"),i=document.getElementById("walletBtnSidebar"),a=document.getElementById("logoutBtnSidebar"),s=document.getElementById("userProfileSection");e&&e.classList.remove("hidden"),t&&t.classList.remove("hidden"),n&&n.classList.add("hidden"),o&&o.classList.add("hidden"),i&&i.classList.add("hidden"),a&&(a.style.display="none"),s&&(s.style.display="none")}const ne=document.getElementById("logoutBtnSidebar");function oe(e){const t=new URL(window.location);t.searchParams.set("page",e),window.history.pushState({},"",t)}function ie(e){document.querySelectorAll(".sidebar .nav-item").forEach(t=>{t.getAttribute("data-page")===e?t.classList.add("active"):t.classList.remove("active")})}function ae(){return/Android/i.test(navigator.userAgent)}function se(){return/iPad|iPhone|iPod/.test(navigator.userAgent)}function le(){return!(se()||/iPad/.test(navigator.userAgent)||"MacIntel"===navigator.platform&&navigator.maxTouchPoints>1||ae()||/webOS|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent))}function re(){var e,t,n,o;if(!E())return;const i={name:document.getElementById("displayName").textContent||"John Doe",phone:(null==(t=null==(e=document.getElementById("displayPhoneLink"))?void 0:e.querySelector(".method-value"))?void 0:t.textContent)||"",email:document.getElementById("displayEmail").textContent||"",website:(null==(o=null==(n=document.getElementById("displayWebsite"))?void 0:n.querySelector(".method-value"))?void 0:o.textContent)||"",qrCodeData:window.location.href};se()?function(e){__async(this,null,function*(){!function(e){R(),q(),e.name,e.phone,e.email,e.website&&e.website,e.qrCodeData}(e);const t=E();"https:"===window.location.protocol&&t?function(e,t,n){__async(this,null,function*(){!function(){const e=document.createElement("div");e.id="wallet-loader",e.style.cssText="\n        position: fixed;\n        top: 0;\n        left: 0;\n        width: 100%;\n        height: 100%;\n        background: rgba(0, 0, 0, 0.8);\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        z-index: 10000;\n        color: white;\n        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n    ",e.innerHTML='\n        <div style="text-align: center;">\n            <div style="width: 40px; height: 40px; border: 3px solid #667eea; border-top: 3px solid transparent; border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 20px;"></div>\n            <p>Generating wallet pass...</p>\n        </div>\n        <style>\n            @keyframes spin {\n                0% { transform: rotate(0deg); }\n                100% { transform: rotate(360deg); }\n            }\n        </style>\n    ',document.body.appendChild(e)}();const e=`/api/card/${E().slug}/apple-wallet-pass`;try{const o=yield fetch(e,{method:"GET",headers:{Accept:"application/vnd.apple.pkpass, application/octet-stream"}});if(U(),!o.ok)throw new Error(`Failed to generate ${n} wallet pass`);const i=window.location.origin+e;if("apple"===n&&se())return;if("google"===n&&ae());else{const e=document.createElement("a");e.href=i,e.download=`${t.name.replace(/\s+/g,"_")}.${"apple"===n?"pkpass":"gwpass"}`,e.style.display="none",document.body.appendChild(e),e.click(),document.body.removeChild(e)}}catch(o){U(),ce()}})}(0,e,"apple"):ce()})}(i):ae()?generateGoogleWalletPass(i):le()?downloadJSONAndShowPreview(i):function(e){const t=`\n    <!DOCTYPE html>\n    <html>\n    <head>\n        <meta charset="UTF-8">\n        <meta name="viewport" content="width=device-width, initial-scale=1.0">\n        <title>Digital Business Card - ${e.name}</title>\n        <style>\n            body {\n                margin: 0;\n                padding: 20px;\n                font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n                background: #f0f0f0;\n                display: flex;\n                flex-direction: column;\n                justify-content: center;\n                align-items: center;\n                min-height: 100vh;\n            }\n            .wallet-pass {\n                width: 340px;\n                max-width: 90vw;\n                height: 220px;\n                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n                border-radius: 15px;\n                color: white;\n                padding: 20px;\n                box-shadow: 0 10px 30px rgba(0,0,0,0.3);\n            }\n            .pass-content h1 {\n                font-size: 20px;\n                margin: 0 0 10px 0;\n            }\n            .pass-content p {\n                margin: 3px 0;\n                font-size: 14px;\n            }\n        </style>\n    </head>\n    <body>\n        <div class="wallet-pass">\n            <div class="pass-content">\n                <h1>${e.name}</h1>\n                <p>${e.phone}</p>\n                <p>${e.email}</p>\n                ${e.website?`<p>${e.website}</p>`:""}\n            </div>\n        </div>\n    </body>\n    </html>`,n=window.open();n.document.write(t),n.document.close()}(i)}function ce(e){!function(e){const t=document.createElement("div");t.style.cssText="\n        position: fixed;\n        top: 0;\n        left: 0;\n        width: 100%;\n        height: 100%;\n        background: rgba(0, 0, 0, 0.8);\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        z-index: 10000;\n    ";const n=document.createElement("div");n.style.cssText="\n        background: white;\n        padding: 30px;\n        border-radius: 20px;\n        max-width: 500px;\n        text-align: center;\n    ",n.innerHTML=e+'\n        <button id="closeModalBtn" \n                style="background: #667eea; color: white; border: none; padding: 10px 20px; \n                       border-radius: 10px; cursor: pointer; font-size: 16px; margin-top: 20px;">\n            Got it!\n        </button>\n    ',t.appendChild(n),document.body.appendChild(t),document.getElementById("closeModalBtn").addEventListener("click",function(){t.remove()})}('\n        <h2>Add to Apple Wallet</h2>\n        <p>To add this business card to your Apple Wallet:</p>\n        <ol style="text-align: left; margin: 20px 0;">\n            <li>A wallet pass file will be generated</li>\n            <li>Tap "Add" when prompted</li>\n            <li>The card will appear in your Wallet app</li>\n        </ol>\n    ')}function de(e){return e.trim().replace(/^@+/,"")}function ue(e,t){const n=de(t),o=a[e];if(!o)return t;if("whatsapp"===e){const e=n.replace(/[^\d+]/g,"");return`${o.baseUrl}${e}`}return"reddit"!==e||n.startsWith("u/"),`${o.baseUrl}${n}`}function me(e,t){if(!t||""===t.trim())return{valid:!0,url:""};const n=t.trim(),o=a[e];if(!o)return{valid:!0,url:n};const i=function(e){if(e.startsWith("http://")||e.startsWith("https://"))return!0;if(e.includes("/"))return!0;if(e.includes(".")){const t=e.split(".");if(t.length>2)return!0;if(2===t.length){const e=t[1].toLowerCase().split("/")[0];return!!s.includes(e)}}return!1}(n);if(!i){if(o.handlePattern){const t=de(n);if(o.handlePattern.test(t)){return{valid:!0,url:ue(e,n)}}return{valid:!1,url:"",error:`Please enter a valid ${e} handle`}}return{valid:!0,url:ue(e,n)}}try{let t=n;t.startsWith("http://")||t.startsWith("https://")||(t="https://"+t);const i=new URL(t);return o.domains.some(e=>i.hostname.includes(e))?{valid:!0,url:t}:{valid:!1,url:"",error:`Please enter a valid ${e} URL or handle`}}catch(l){if(o.handlePattern){const t=de(n);if(o.handlePattern.test(t)){return{valid:!0,url:ue(e,n)}}return{valid:!1,url:"",error:`Please enter a valid ${e} handle or URL`}}return{valid:!0,url:ue(e,n)}}}function he(e,t){const n=document.getElementById(e);if(!n)return!0;const o=n.value.trim();if(!o)return!0;if("website"===e)try{let e=o;return e.startsWith("http://")||e.startsWith("https://")||(e="https://"+e),new URL(e),n.setAttribute("data-final-url",e),!0}catch(a){return u(e,t),!1}const i=me(e,o);return i.valid?(n.setAttribute("data-final-url",i.url),!0):(u(e,i.error||t),!1)}function ye(e){return/^\w+([.-]?\w+)*@\w+([.-]?\w+)*(\.\w{2,3})+$/.test(e)}function ge(e,t,n){const o=document.getElementById(e).value.trim();return!(o.length>t)||(u(e,`${n} cannot be more than ${t} characters (current: ${o.length})`),!1)}function pe(){const e=document.getElementById("name"),t=document.getElementById("organization"),n=e.value.trim().toLowerCase(),o=t.value.trim().toLowerCase();return!n||!o||n!==o||(u("organization","Organization name cannot be the same as your name"),!1)}function fe(e,t){return!!document.getElementById(e).value.trim()||(u(e,t),!1)}function ve(e){const t=document.getElementById(e).value.trim();return!t||(!!/^\d{10}$/.test(t)||(u(e,"Please enter exactly 10 digits"),!1))}function we(){m();let e=!0;e=fe("name","Full name is required")&&e,e=fe("email","Email address is required")&&e;const t=document.getElementById("name").value.trim();t&&(e=ge("name",o,"Name")&&e);const n=document.getElementById("organization").value.trim();n&&(e=ge("organization",i,"Organization")&&e),t&&n&&(e=pe()&&e);const a=document.getElementById("phone").value.trim(),s=document.getElementById("mobile").value.trim();a&&(e=ve("phone")&&e),s&&(e=ve("mobile")&&e);return document.getElementById("website").value.trim()&&(e=he("website","Please enter a valid website URL")&&e),l.forEach(t=>{document.getElementById(t).value.trim()&&(e=he(t,`Please enter a valid ${t} URL`)&&e)}),e}function be(){const e=document.getElementById("profileForm");e&&(e.addEventListener("input",function(e){setTimeout(()=>{we()},100)}),e.addEventListener("blur",function(e){const t=e.target.id;if(t){if(l.includes(t)){const t=e.target.closest(".social-item"),n=null==t?void 0:t.querySelector(".input-error");n&&(n.innerHTML="")}else{const t=e.target.parentNode.querySelector(".error-message");t&&t.remove()}e.target.style.borderColor="",e.target.style.backgroundColor="",function(e,t){let n=!0;switch(e){case"name":if(n=fe(e,"Full name is required"),n&&t&&(n=ge("name",o,"Name")),n&&t){document.getElementById("organization").value.trim()&&(n=pe())}break;case"organization":if(t&&(n=ge("organization",i,"Organization")),n&&t){document.getElementById("name").value.trim()&&(n=pe())}break;case"email":n=fe(e,"Email is required");break;case"phone":case"mobile":t&&(n=ve(e));break;case"website":t&&(n=he("website","Please enter a valid website URL"));break;default:l.includes(e)&&t&&(n=he(e,`Please enter a valid ${e} URL`))}}(t,e.target.value.trim()),setTimeout(()=>{we()},50)}},!0))}ne&&ne.addEventListener("click",function(){return __async(this,null,function*(){try{yield L(),te(),J("home"),oe("home"),ie("home"),c("Logged out successfully")}catch(e){d("Error logging out")}})}),window.addEventListener("popstate",function(){const e=new URLSearchParams(window.location.search).get("page")||"home";J(e),ie(e)}),"undefined"!=typeof window&&(window.verticalNav={init:K,setActive:ie,closeMobile:Y,checkAuth:X,updateAuthUI:ee,updateGuestUI:te}),"loading"===document.readyState?document.addEventListener("DOMContentLoaded",K):K();const Ee={privacy:"privacy-modal",terms:"terms-modal",faq:"faq-modal",suggestions:"suggestions-modal",contact:"contact-modal"},Ce={privacy:"privacy-link",terms:"terms-link",faq:"faq-link",suggestions:"suggestions-link",contact:"contact-link"};function Ie(){Object.entries(Ce).forEach(([e,t])=>{const n=document.getElementById(t);n&&n.addEventListener("click",t=>{t.preventDefault(),function(e){const t=Ee[e],n=document.getElementById(t);n&&(n.style.display="block",document.body.style.overflow="hidden")}(e)})})}function $e(){document.querySelectorAll(".close").forEach(e=>{e&&e.addEventListener("click",()=>{Object.values(Ee).forEach(e=>{const t=document.getElementById(e);t&&"block"===t.style.display&&(t.style.display="none")}),document.body.style.overflow="auto"})}),Object.values(Ee).forEach(e=>{const t=document.getElementById(e);t&&t.addEventListener("click",e=>{e.target===t&&(t.style.display="none",document.body.style.overflow="auto")})})}function Le(){Ie(),$e(),document.querySelectorAll(".faq-question").forEach(e=>{e&&e.addEventListener("click",()=>{const t=e.nextElementSibling;if(t){const e=t.classList.contains("show");document.querySelectorAll(".faq-answer").forEach(e=>{e.classList.remove("show")}),e||t.classList.add("show")}})})}function ke(e){return __async(this,null,function*(){e.preventDefault();const t=document.getElementById("contact-success");t&&(t.style.display="none");const n=new FormData(e.target),o={name:n.get("name"),email:n.get("email"),category:n.get("category"),title:n.get("title"),details:n.get("details")},i=e.target.querySelector('button[type="submit"]'),a=i.innerHTML,s=function(e){const t=[];return(!e.name||e.name.trim().length<2)&&t.push({field:"suggestion-name",message:"Name must be at least 2 characters"}),e.email&&ye(e.email)||t.push({field:"suggestion-email",message:"Please enter a valid email address"}),(!e.title||e.title.trim().length<5)&&t.push({field:"suggestion-title",message:"Title must be at least 5 characters"}),(!e.details||e.details.trim().length<20)&&t.push({field:"suggestion-details",message:"Details must be at least 20 characters"}),t}(o);if(s.length>0)return l=s,document.querySelectorAll(".form-error").forEach(e=>e.remove()),void l.forEach(e=>{const t=document.getElementById(e.field);if(t){const n=document.createElement("div");n.className="form-error",n.style.cssText="\n                color: #dc3545;\n                font-size: 0.875rem;\n                margin-top: 0.25rem;\n            ",n.textContent=e.message,t.parentNode.insertBefore(n,t.nextSibling),t.style.borderColor="#dc3545"}});var l;i.innerHTML='<i class="fas fa-spinner fa-spin"></i> Submitting...',i.disabled=!0;try{const t=yield r.updatesuggestions(o);if(!t||!t.success)throw new Error(t.message||"Failed to submit suggestion");{c(t.message),e.target.reset();const n=e.target.closest(".modal");n&&(n.style.display="none",document.body.style.overflow="auto")}}catch(u){let e="There was an error submitting your suggestion. ";u.message.includes("fetch")||u.message.includes("NetworkError")?e+="Please check your internet connection and try again.":u.message.includes("similar suggestion")?e="A similar suggestion was already submitted recently. Please try a different suggestion.":e+=u.message||"Please try again later.",d(e)}finally{i.innerHTML=a,i.disabled=!1}})}function Se(e){return __async(this,null,function*(){e.preventDefault();const t=document.getElementById("contact-success");t&&(t.style.display="none");const n=new FormData(e.target),o={name:n.get("name"),email:n.get("email"),phone:n.get("phone"),subject:n.get("subject"),message:n.get("message")},i=e.target.querySelector('button[type="submit"]'),a=i.innerHTML,s=!(l=o).name||l.name.trim().length<2?"Please enter a valid name (at least 2 characters)":l.email&&ye(l.email)?l.subject?!l.message||l.message.trim().length<10?"Please enter a message (at least 10 characters)":l.phone&&l.phone.trim()&&(u=l.phone,!/^[\+]?[1-9][\d]{0,15}$/.test(u.trim()))?"Please enter a valid phone number or leave it empty":null:"Please select a subject":"Please enter a valid email address";var l,u;if(s)d(s);else{i.innerHTML='<i class="fas fa-spinner fa-spin"></i> Sending...',i.disabled=!0;try{const n=yield r.updatecontactinfo(o);if(!n||!n.success)throw new Error(n.message||"Failed to send message");t?(t.style.display="block",t.textContent="Thank you for contacting us. We will get back to you soon!"):c("Thank you for contacting us. We will get back to you soon!"),e.target.reset(),setTimeout(()=>{const e=document.getElementById("contact-modal");e&&(e.style.display="none",document.body.style.overflow="auto"),t&&(t.style.display="none")},3e3)}catch(m){let e="There was an error sending your message. ";m.message.includes("fetch")||m.message.includes("NetworkError")?e+="Please check your internet connection and try again.":m.message.includes("validation")||m.message.includes("required")?e="Please fill in all required fields correctly.":e+=m.message||"Please try again later.",d(e)}finally{i.innerHTML=a,i.disabled=!1}}})}function Be(){return __async(this,null,function*(){const e=localStorage.getItem("token");if(e)try{const t=yield $.ajax({url:"/api/profile",method:"GET",headers:{Authorization:"Bearer "+e}});t.success&&function(e){let t=$("#navbarAvatar");if(t.show().empty(),e.hasProfilePhoto){const n=`${api.baseURL}/api/profile/photo/c/${e.cardId}`;t.html(`\n        <img src="${n}" \n             alt="${e.name||e.username}" \n             onerror="this.style.display='none'; this.parentElement.textContent='${e.initials}';">\n    `)}else t.text(e.initials);t.css("cursor","pointer").off("click").on("click",function(){window.location.href="/profile"})}(t.profile)}catch(t){$("#navbarAvatar").hide()}else $("#navbarAvatar").hide()})}$(document).ready(function(){}),$(window).on("focus",function(){Be()});class _e{constructor(){this.countries=[],this.currentStates=[],this.currentCities=[],this.selectedCountry=null,this.selectedState=null,this.selectedCity=null,this.currentSelectedIndex=-1,this.activeDropdown=null,this.filteredCountries=[],this.filteredStates=[],this.filteredCities=[],this.initAutocomplete()}getFilteredCountries(){return this.filteredCountries}getFilteredStates(){return this.filteredStates}getFilteredCities(){return this.filteredCities}handleCountryInput(e){const t=document.getElementById("countryDropdown");if(!e||e.length<1)return t.classList.remove("active"),void(this.filteredCountries=[]);this.filteredCountries=this.countries.filter(t=>t.name.toLowerCase().includes(e.toLowerCase())),this.displayCountryResults(this.filteredCountries,t)}handleStateInput(e){const t=document.getElementById("stateDropdown");if(!e||e.length<1)return t.classList.remove("active"),void(this.filteredStates=[]);this.filteredStates=this.currentStates.filter(t=>t.name.toLowerCase().includes(e.toLowerCase())),this.displayStateResults(this.filteredStates,t)}handleCityInput(e){const t=document.getElementById("cityDropdown");if(!e||e.length<1)return t.classList.remove("active"),void(this.filteredCities=[]);this.filteredCities=this.currentCities.filter(t=>t.name.toLowerCase().includes(e.toLowerCase())),this.displayCityResults(this.filteredCities,t)}loadCountries(){return __async(this,null,function*(){try{const e=yield fetch("/data/countries_states_cities.json");if(!e.ok)throw new Error("Failed to load countries data");const t=yield e.json();this.countries=t.map(e=>({name:e.name,code:e.iso2,iso3:e.iso3,flag:e.emoji||"🌍",phonecode:e.phonecode,currency:e.currency,region:e.region,states:e.states||[]}))}catch(e){}})}initAutocomplete(){const e=document.getElementById("country"),t=document.getElementById("countryDropdown");e&&(e.addEventListener("input",e=>{this.currentSelectedIndex=-1,this.handleCountryInput(e.target.value)}),e.addEventListener("focus",()=>{this.activeDropdown="country",e.value&&this.handleCountryInput(e.value)}),e.addEventListener("blur",()=>{setTimeout(()=>{"country"===this.activeDropdown&&(this.activeDropdown=null)},200)}),e.addEventListener("keydown",n=>{document.activeElement===e&&t.classList.contains("active")&&this.handleKeyboardNavigation(n,"countryDropdown")}),document.addEventListener("click",n=>{e.contains(n.target)||t.contains(n.target)||(t.classList.remove("active"),this.currentSelectedIndex=-1)}));const n=document.getElementById("state"),o=document.getElementById("stateDropdown");n&&(n.addEventListener("input",e=>{this.currentSelectedIndex=-1,this.handleStateInput(e.target.value)}),n.addEventListener("focus",()=>{this.activeDropdown="state",n.value&&this.handleStateInput(n.value)}),n.addEventListener("blur",()=>{setTimeout(()=>{"state"===this.activeDropdown&&(this.activeDropdown=null)},200)}),n.addEventListener("keydown",e=>{document.activeElement===n&&o.classList.contains("active")&&this.handleKeyboardNavigation(e,"stateDropdown")}),document.addEventListener("click",e=>{n.contains(e.target)||o.contains(e.target)||(o.classList.remove("active"),this.currentSelectedIndex=-1)}));const i=document.getElementById("city"),a=document.getElementById("cityDropdown");i&&(i.addEventListener("input",e=>{this.currentSelectedIndex=-1,this.currentCities.length>0&&this.handleCityInput(e.target.value)}),i.addEventListener("focus",()=>{this.activeDropdown="city",i.value&&this.currentCities.length>0&&this.handleCityInput(i.value)}),i.addEventListener("blur",()=>{setTimeout(()=>{"city"===this.activeDropdown&&(this.activeDropdown=null)},200)}),i.addEventListener("keydown",e=>{document.activeElement===i&&this.currentCities.length>0&&a.classList.contains("active")&&this.handleKeyboardNavigation(e,"cityDropdown")}),document.addEventListener("click",e=>{i.contains(e.target)||a.contains(e.target)||(a.classList.remove("active"),this.currentSelectedIndex=-1)}))}handleKeyboardNavigation(e,t){const n=document.getElementById(t);if(!n||!n.classList.contains("active"))return;const o=n.querySelectorAll(".autocomplete-item");if(0!==o.length)switch(e.key){case"ArrowDown":e.preventDefault(),e.stopPropagation(),this.currentSelectedIndex=(this.currentSelectedIndex+1)%o.length,this.updateSelection(o);break;case"ArrowUp":e.preventDefault(),e.stopPropagation(),this.currentSelectedIndex=this.currentSelectedIndex<=0?o.length-1:this.currentSelectedIndex-1,this.updateSelection(o);break;case"Enter":e.preventDefault(),e.stopPropagation();const i=o[this.currentSelectedIndex>=0?this.currentSelectedIndex:0];i&&i._data&&("countryDropdown"===t?this.selectCountry(i._data):"stateDropdown"===t?this.selectState(i._data):"cityDropdown"===t&&this.selectCity(i._data)),n.classList.remove("active"),this.currentSelectedIndex=-1;break;case"Escape":e.preventDefault(),e.stopPropagation(),n.classList.remove("active"),this.currentSelectedIndex=-1;break;case"Tab":n.classList.remove("active"),this.currentSelectedIndex=-1}}updateSelection(e){e.forEach(e=>e.classList.remove("selected")),this.currentSelectedIndex>=0&&e[this.currentSelectedIndex]&&(e[this.currentSelectedIndex].classList.add("selected"),e[this.currentSelectedIndex].scrollIntoView({block:"nearest",behavior:"smooth"}))}handleCountryInput(e){const t=document.getElementById("countryDropdown");if(!e||e.length<1)return void t.classList.remove("active");const n=this.countries.filter(t=>t.name.toLowerCase().includes(e.toLowerCase()));this.displayCountryResults(n,t)}displayCountryResults(e,t){if(t.innerHTML="",this.currentSelectedIndex=-1,0===e.length)return t.innerHTML='<div class="autocomplete-no-results">No countries found</div>',void t.classList.add("active");e.slice(0,10).forEach((e,n)=>{const o=document.createElement("div");o.className="autocomplete-item",o.innerHTML=`<span class="flag">${e.flag}</span> ${e.name}`,o._data=e,o._index=n,o.addEventListener("mousedown",t=>{t.preventDefault(),this.selectCountry(e)}),t.appendChild(o)}),t.classList.add("active")}selectCountry(e){this.selectedCountry=e;const t=document.getElementById("country"),n=document.getElementById("countryCode"),o=document.getElementById("countryDropdown");t&&(t.value=e.name),n&&(n.value=e.code),o&&o.classList.remove("active"),this.selectedState=null,this.selectedCity=null,this.currentStates=[],this.currentCities=[],this.currentSelectedIndex=-1;const i=document.getElementById("state"),a=document.getElementById("stateId");i&&(i.value=""),a&&(a.value=""),this.resetCity(),this.loadStates(e)}loadStates(e){if(!e.states||0===e.states.length){this.currentStates=[];const e=document.getElementById("state");return void(e&&(e.disabled=!0,e.placeholder="No states available"))}this.currentStates=e.states.map(e=>({id:e.id,name:e.name,code:e.iso2,cities:e.cities||[]}));const t=document.getElementById("state");t&&(t.disabled=!1,t.placeholder="Start typing state name...")}handleStateInput(e){const t=document.getElementById("stateDropdown");if(!e||e.length<1)return void t.classList.remove("active");const n=this.currentStates.filter(t=>t.name.toLowerCase().includes(e.toLowerCase()));this.displayStateResults(n,t)}displayStateResults(e,t){if(t.innerHTML="",this.currentSelectedIndex=-1,0===e.length)return t.innerHTML='<div class="autocomplete-no-results">No states found</div>',void t.classList.add("active");e.slice(0,10).forEach((e,n)=>{const o=document.createElement("div");o.className="autocomplete-item",o.textContent=e.name,o.setAttribute("data-state-code",e.code),o.setAttribute("data-state-id",e.id),o._data=e,o._index=n,o.addEventListener("mousedown",t=>{t.preventDefault(),this.selectState(e)}),t.appendChild(o)}),t.classList.add("active")}selectState(e){this.selectedState=e;const t=document.getElementById("state"),n=document.getElementById("stateId"),o=document.getElementById("stateCode"),i=document.getElementById("stateDropdown");t&&(t.value=e.name),n&&(n.value=e.id),o&&(o.value=e.code),i&&i.classList.remove("active"),this.selectedCity=null,this.currentCities=[],this.currentSelectedIndex=-1;const a=document.getElementById("city"),s=document.getElementById("cityId");a&&(a.value=""),s&&(s.value=""),this.loadCities(e)}loadCities(e){if(!e.cities||0===e.cities.length){this.currentCities=[];const e=document.getElementById("city");return void(e&&(e.disabled=!1,e.placeholder="Type city name manually..."))}this.currentCities=e.cities.map(e=>({id:e.id,name:e.name,latitude:e.latitude,longitude:e.longitude}));const t=document.getElementById("city");t&&(t.disabled=!1,t.placeholder="Start typing city name...")}handleCityInput(e){const t=document.getElementById("cityDropdown");if(!e||e.length<1)return void t.classList.remove("active");const n=this.currentCities.filter(t=>t.name.toLowerCase().includes(e.toLowerCase()));this.displayCityResults(n,t)}displayCityResults(e,t){if(t.innerHTML="",this.currentSelectedIndex=-1,0===e.length)return t.innerHTML='<div class="autocomplete-no-results">No cities found - you can type manually</div>',void t.classList.add("active");e.slice(0,10).forEach((e,n)=>{const o=document.createElement("div");o.className="autocomplete-item",o.textContent=e.name,o._data=e,o._index=n,o.addEventListener("mousedown",t=>{t.preventDefault(),this.selectCity(e)}),t.appendChild(o)}),t.classList.add("active")}selectCity(e){this.selectedCity=e;const t=document.getElementById("city"),n=document.getElementById("cityId"),o=document.getElementById("cityDropdown");t&&(t.value=e.name),n&&(n.value=e.id),o&&o.classList.remove("active"),this.currentSelectedIndex=-1}resetCity(){const e=document.getElementById("city"),t=document.getElementById("cityId"),n=document.getElementById("cityDropdown");e&&(e.value="",e.disabled=!0,e.placeholder="Select state first..."),t&&(t.value=""),n&&n.classList.remove("active"),this.selectedCity=null,this.currentCities=[]}getSelectedLocation(){const e=document.getElementById("city"),t=e?e.value:null;return{country:this.selectedCountry,state:this.selectedState,city:this.selectedCity||{name:t}}}}let Pe;document.addEventListener("DOMContentLoaded",()=>__async(this,null,function*(){Pe=new _e,yield Pe.loadCountries()}));const xe={getWallet(){return __async(this,null,function*(){try{const e=yield fetch("/api/wallet",{credentials:"include"});return yield e.json()}catch(e){return{success:!1,message:"Failed to fetch wallet"}}})},addCard(e){return __async(this,null,function*(){try{const t=yield fetch(`/api/wallet/add/${e}`,{method:"POST",credentials:"include"});return yield t.json()}catch(t){return{success:!1,message:"Failed to add card"}}})},removeCard(e){return __async(this,null,function*(){try{const t=yield fetch(`/api/wallet/remove/${e}`,{method:"DELETE",credentials:"include"});return yield t.json()}catch(t){return{success:!1,message:"Failed to remove card"}}})},checkCard(e){return __async(this,null,function*(){try{const t=yield fetch(`/api/wallet/check/${e}`,{credentials:"include"});return yield t.json()}catch(t){return{success:!1,inWallet:!1}}})}};function Te(){const e=document.getElementById("walletCardsContainer");if(!e)return;const t=e.cloneNode(!0);e.parentNode.replaceChild(t,e),t.addEventListener("click",function(e){return __async(this,null,function*(){if(e.target.closest(".shareWalletCardlink")){const t=e.target.closest(".shareWalletCardlink");t.getAttribute("data-cardid");const n=t.getAttribute("data-cardname"),o=t.getAttribute("data-slug");yield Ue(o,n)}if(e.target.closest(".removecardFromWallet")){const t=e.target.closest(".removecardFromWallet"),n=t.getAttribute("data-cardid"),o=t.getAttribute("data-cardname");yield qe(n,o)}})})}function Ae(){return __async(this,null,function*(){const e=document.getElementById("walletCardsContainer"),t=document.getElementById("emptyWalletMessage");if(!e)return;e.innerHTML='<div style="text-align: center; padding: 2rem; color: white;"><i class="fas fa-spinner fa-spin" style="font-size: 2rem;"></i><p>Loading wallet...</p></div>';const n=yield xe.getWallet();if(!n.success||!n.wallet||0===n.wallet.cards.length)return e.innerHTML="",void(t.style.display="block");t.style.display="none",e.innerHTML=n.wallet.cards.map(e=>function(e){const t=function(e){if(!e)return"U";const t=e.trim().split(" ");if(t.length>=2)return(t[0][0]+t[t.length-1][0]).toUpperCase();return e.substring(0,2).toUpperCase()}(e.name),n=new Date(e.addedAt).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"});let o;if(e.hasProfilePhoto){o=`<img src="${`${r.baseURL}/api/profile/photo/c/${e.cardId}`}" \n                           alt="${Re(e.name)}" \n                           crossorigin="anonymous"\n                           onerror="this.style.display='none'; this.parentElement.innerHTML='<span>${t}</span>';">`}else o=`<span>${t}</span>`;e.organization;const i=e.title||"";return`\n        <div class="digital-wallet-card" data-card-id="${Re(e.slug)}" data-cardid="${Re(e.cardId)}">\n      \n            \n            \x3c!-- Colored Header Section --\x3e\n            <div class="wallet-card-header-section">\n                <div class="wallet-card-brand-name">${Re(e.organization)}</div>\n                <div class="wallet-qr-top-container">\n                    <img src="/card/${Re(e.slug)}/qr" alt="QR Code for ${Re(e.name)}">\n                </div>\n                \x3c!-- Overlapping Profile Photo --\x3e\n                <div class="wallet-card-avatar-overlap">\n                    ${o}\n                </div>\n            </div>\n            \n            \x3c!-- Content Section --\x3e\n            <div class="wallet-card-content">\n                <div class="empty-div"></div>\n                <div class="actual-content">\n                <div class="wallet-card-name">${Re(e.name)}</div>\n                ${i?`<div class="wallet-card-title">${Re(i)}</div>`:""}\n                <div class="wallet-card-email"><a href="mailto:${Re(e.email)}" class="wallet-display-email" title="Email">${Re(e.email)}</a></div>\n          \n                </div>\n            </div>\n            \n            \x3c!-- Contact Icons --\x3e\n            <div class="wallet-card-contacts">\n                ${e.email?`<a href="mailto:${Re(e.email)}" class="wallet-contact-icon-btn" title="Email"><i class="fas fa-envelope"></i></a>`:""}\n                ${e.phone?`<a href="tel:${Re(e.phone)}" class="wallet-contact-icon-btn" title="Call"><i class="fas fa-phone"></i></a>`:""}\n                ${e.phone?`<a href="sms:${Re(e.phone)}" class="wallet-contact-icon-btn" title="Message"><i class="fas fa-sms"></i></a>`:""}\n                <a href="/card/${Re(e.slug)}" target="_blank" class="wallet-contact-icon-btn" title="View Card"><i class="fas fa-address-card"></i></a>\n            </div>\n            \n            \x3c!-- Action Buttons - KEEPING YOUR FORMAT --\x3e\n            <div class="wallet-card-actions">\n                <a href="/card/${Re(e.slug)}" target="_blank" class="wallet-action-btn primary">\n                    <i class="fas fa-eye"></i> View\n                </a>\n                <button class="wallet-action-btn primary shareWalletCardlink" data-cardid="${Re(e.cardId)}" data-slug="${Re(e.slug)}" data-cardname="${Re(e.name)}">\n                    <i class="fas fa-share-alt"></i> Share\n                </button>\n                <button class="wallet-action-btn danger removecardFromWallet" data-cardid="${Re(e.cardId)}" data-slug="${Re(e.slug)}" data-cardname="${Re(e.name)}">\n                    <i class="fas fa-trash"></i> Remove\n                </button>\n            </div>\n            \n            <div class="wallet-card-added-date">\n                Added ${n}\n            </div>\n        </div>\n    `}(e)).join(""),Te()})}function Re(e){if(!e)return"";const t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};return e.toString().replace(/[&<>"']/g,e=>t[e])}function qe(e,t){return __async(this,null,function*(){if(!confirm(`Are you sure you want to remove ${t} from your wallet?`))return;const n=yield xe.removeCard(e);if(n.success){c("Card removed from wallet");$(`[data-cardid="${e}"]`).remove();const t=document.querySelector(`[data-card-id="${e}"]`);t&&(t.style.transition="opacity 0.3s ease, transform 0.3s ease",t.style.opacity="0",t.style.transform="scale(0.9)",setTimeout(()=>{t.remove();0===document.querySelectorAll(".digital-wallet-card").length&&(document.getElementById("emptyWalletMessage").style.display="block")},300))}else d(n.message||"Failed to remove card from wallet")})}function Ue(e,t){const n=`${window.location.origin}/card/${e}`;navigator.share?navigator.share({title:`${t}'s Digital Card`,text:`Check out ${t}'s digital business card`,url:n}).then(()=>{}).catch(e=>{"AbortError"===e.name||Me(n)}):Me(n)}function Me(e){const t=document.createElement("textarea");t.value=e,t.style.position="fixed",t.style.opacity="0",document.body.appendChild(t),t.select();try{document.execCommand("copy"),c("Link copied to clipboard!")}catch(n){alert(`Copy this link: ${e}`)}document.body.removeChild(t)}function De(){return __async(this,null,function*(){"function"==typeof initializeWalletButton&&initializeWalletButton();try{const e=yield r.getUserWithProfile();if(e.success&&e.authenticated){v(e.user),e.profile?(w(e.profile),function(e){const t=document.getElementById("email");t&&(t.value=e,t.setAttribute("readonly",!0),t.style.backgroundColor="#f8f9fa",t.style.cursor="not-allowed",t.style.color="#6c757d")}(e.profile.email),$("#navbarAvatar").show(),$("#navbarAvatarDesktop").show(),J("display"),$("#footer-cta").addClass("display-none-cta-button"),$("#singup-cta-button-div-uc").addClass("display-none-cta-button"),"function"==typeof handlePendingWalletCard&&(yield handlePendingWalletCard()),Z()):J("profile"),k(),S();const t=new URLSearchParams(window.location.search),n=t.get("page");n?J(n):e.profile?J("display"):J("profile"),"success"===t.get("auth")&&(c("Successfully logged in!"),window.history.replaceState({},document.title,window.location.pathname))}else currentUser=null,userProfile=null,k(),J("home")}catch(t){v(null),Z(),$("#footer-cta").removeClass("display-none-cta-button"),$("#singup-cta-button-div-uc").removeClass("display-none-cta-button")}k(),S();const e=new URLSearchParams(window.location.search);"success"===e.get("auth")?(c("Successfully logged in!"),setTimeout(()=>__async(this,null,function*(){"function"==typeof handlePendingWalletCard&&(yield handlePendingWalletCard());const e=yield r.getProfile();e.success&&e.profile?J("display"):J("profile")}),1e3),window.history.replaceState({},document.title,window.location.pathname)):e.get("error")&&(d("Login failed. Please try again."),Z(),$("#footer-cta").removeClass("display-none-cta-button"),$("#singup-cta-button-div-uc").removeClass("display-none-cta-button"))})}function Oe(){const e=document.querySelector(".navbar"),t=document.querySelector(".container");window.innerWidth<330?(e.style.display="none",t.style.display="none",function(){if(document.getElementById("resolution-message"))return;const e=document.createElement("div");e.id="resolution-message",e.style.cssText="\n        position: fixed;\n        top: 0;\n        left: 0;\n        width: 100%;\n        height: 100%;\n        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        z-index: 9999;\n    ",e.innerHTML=`\n        <div style="background: white; padding: 2rem; border-radius: 20px; text-align: center; max-width: 90%;">\n            <div style="font-size: 3rem; margin-bottom: 1rem;">📱</div>\n            <h2 style="color: #333; margin-bottom: 1rem;">Screen Too Small</h2>\n            <p style="color: #666; line-height: 1.5;">\n                This application requires a minimum screen width of 400px.\n            </p>\n            <p style="color: #999; font-size: 0.9rem;">\n                Current width: ${window.innerWidth}px | Required: 400px minimum\n            </p>\n        </div>\n    `,document.body.appendChild(e)}()):(e.style.display="flex",t.style.display="block",function(){const e=document.getElementById("resolution-message");e&&e.remove()}())}"undefined"!=typeof window&&(window.walletAPI=xe,window.loadWalletCards=Ae,window.removeFromWallet=qe,window.shareWalletCard=Ue,window.handlePendingWalletCard=function(){return __async(this,null,function*(){const e=sessionStorage.getItem("pendingWalletCard"),t=sessionStorage.getItem("redirectToWallet");if(e&&t){sessionStorage.removeItem("pendingWalletCard"),sessionStorage.removeItem("redirectToWallet");const t=yield xe.addCard(e);t.success?(showPage("wallet"),c("Card added to your wallet successfully!")):d(t.message||"Failed to add card to wallet")}})},window.initializeWalletButton=function(){const e=document.getElementById("walletBtn"),t=document.getElementById("walletBtnMobile");e&&e.addEventListener("click",()=>__async(this,null,function*(){showPage("wallet"),yield Ae()})),t&&t.addEventListener("click",()=>__async(this,null,function*(){showPage("wallet"),yield Ae()}))},window.attachWalletCardListeners=Te),document.addEventListener("DOMContentLoaded",function(){return __async(this,null,function*(){$("#navbarAvatar").hide(),$("#navbarAvatarDesktop").hide(),function(){function e(){$("#hamburgerMenu").removeClass("active"),$("#mobileMenu").removeClass("active"),$("body").removeClass("menu-open")}$("#signupWithGoogle-btn").on("click",I),$("#singup-cta-button").on("click",()=>J("signup")),$("#singup-cta-button-uc").on("click",()=>J("signup")),$("#signupBtn").on("click",()=>J("signup")),$("#faqBtn").on("click",()=>J("faq")),$("#usecaseBtn").on("click",()=>J("usecase")),$("#homepage-signup").on("click",()=>J("signup")),$(".signupbutton").on("click",()=>J("signup")),$(".homebutton").on("click",()=>J("home")),$(".profilebutton").on("click",()=>J("home")),$("#loginBtn").on("click",()=>J("login")),$("#displayBtn").on("click",()=>J("display")),$("#profileBtn").on("click",()=>J("profile")),$("#logoutBtn").on("click",L),$("#googlesignin-button").on("click",C),$("#qr-upload-div").on("click",()=>document.getElementById("qrUpload").click()),$("#downloadVCard-btn").on("click",W),$("#shareCard-btn").on("click",M),$("#addToWallet-btn").on("click",re),$("#downloadQRCode-btn").on("click",F),$(document).on("click","#downloadQRCode-btn-dynamic",F),$(document).on("click","#downloadonlyQRCode-btn-dynamic",H),$(document).on("click","#downloadVCard-btn-dynamic",W),$(document).on("click",".copy-url-btn",M),$(".save-btn").on("click",function(e){e.preventDefault(),we()?V():(h(),d("Please fix the errors before saving"))}),$("#hamburgerMenu").on("click",function(){$(this).toggleClass("active"),$("#mobileMenu").toggleClass("active"),$("body").toggleClass("menu-open")}),$(document).on("click",function(e){$(e.target).closest(".mobile-menu, .hamburger-menu").length||($("#hamburgerMenu").removeClass("active"),$("#mobileMenu").removeClass("active"),$("body").removeClass("menu-open"))}),$(".mobile-menu-btn.homebutton").on("click",function(){$(".homebutton").first().click(),e()}),$("#loginBtnMobile").on("click",()=>{$("#loginBtn").click(),e()}),$("#signupBtnMobile").on("click",()=>{$("#signupBtn").click(),e()}),$("#profileBtnMobile").on("click",()=>{$("#profileBtn").click(),e()}),$("#displayBtnMobile").on("click",()=>{$("#displayBtn").click(),e()}),$("#walletBtnMobile").on("click",()=>{$("#walletBtn").click(),e()}),$("#usecaseBtnMobile").on("click",()=>{$("#usecaseBtn").click(),e()}),$("#faqBtnMobile").on("click",()=>{$("#faqBtn").click(),e()}),$("#logoutBtnMobile").on("click",()=>{$("#logoutBtn").click(),e()})}(),Le(),function(){const e=document.getElementById("suggestions-form");e&&(e.addEventListener("submit",ke),e.addEventListener("input",e=>{if("INPUT"===e.target.tagName||"TEXTAREA"===e.target.tagName){e.target.style.borderColor="";const t=e.target.parentNode.querySelector(".form-error");t&&t.remove()}}))}(),function(){const e=document.getElementById("contact-form");e&&(e.addEventListener("submit",Se),e.addEventListener("input",e=>{"INPUT"!==e.target.tagName&&"TEXTAREA"!==e.target.tagName&&"SELECT"!==e.target.tagName||(e.target.style.borderColor="")}));const t=document.getElementById("contact-modal"),n=null==t?void 0:t.querySelector(".close");n&&n.addEventListener("click",function(){t.style.display="none",document.body.style.overflow="auto";const e=document.getElementById("contact-success");e&&(e.style.display="none")}),t&&t.addEventListener("click",function(e){if(e.target===t){t.style.display="none",document.body.style.overflow="auto";const e=document.getElementById("contact-success");e&&(e.style.display="none")}})}(),O(),be(),$("#isPublic").on("change",function(){const e=$(this).is(":checked"),t=$(this).closest(".form-group").find(".form-text");e?(t.text("When checked, others can view your card using the link or QR code"),t.removeClass("text-danger").addClass("text-muted")):(t.text("Your card will be private - only you can access it when logged in"),t.removeClass("text-muted").addClass("text-danger"))}),yield De(),Oe(),window.addEventListener("resize",Oe),$(window).on("popstate",Z),$(window).on("hashchange",Z)})}),document.addEventListener("click",function(e){const t=document.querySelector(".user-menu"),n=document.getElementById("userDropdown");n&&t&&!t.contains(e.target)&&(n.style.display="none")}),window.showPage=J,window.trackSocialClick=t=>e(()=>Promise.resolve().then(()=>Q)).then(e=>e.trackSocialClick(t))}();
